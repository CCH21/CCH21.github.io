<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="John Doe">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Welcome to CCH21&#39;s Blog"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Welcome to CCH21&#39;s Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>page - Welcome to CCH21&#39;s Blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">Welcome to CCH21's Blog</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/11/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%BA%93(3)/">
                Python数据分析基础之数据库(3)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-11</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="查询一个表并将输出写入CSV文件"><a href="#查询一个表并将输出写入CSV文件" class="headerlink" title="查询一个表并将输出写入CSV文件"></a>查询一个表并将输出写入CSV文件</h2><p>&emsp;&emsp;数据表中有了数据之后，最常见的下一个步骤就是使用查询从表中取出一组数据进行分析。使用Python脚本可以从数据表中查询出一组特定记录。<br>&emsp;&emsp;下面的代码会从<code>Suppliers</code>数据表中查询出<code>Cost</code>列中的值大于700.00的所有记录，并将这些记录所有列中的值输出。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import MySQLdb</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"># CSV输出文件的路径和文件名</span><br><span class="line">output_file = sys.argv[1]</span><br><span class="line"></span><br><span class="line"># 连接MySQL数据库</span><br><span class="line">con = MySQLdb.connect(host=&apos;localhost&apos;, port=3306, db=&apos;my_suppliers&apos;, user=&apos;root&apos;, passwd=&apos;## your password ##&apos;)</span><br><span class="line">c = con.cursor()</span><br><span class="line"></span><br><span class="line"># 创建写文件的对象，并写入标题行</span><br><span class="line">filewriter = csv.writer(open(output_file, &apos;w&apos;, newline=&apos;&apos;), delimiter=&apos;,&apos;)</span><br><span class="line">header = [&apos;Supplier Name&apos;, &apos;Invoice Number&apos;, &apos;Part Number&apos;, &apos;Cost&apos;, &apos;Purchase Date&apos;]</span><br><span class="line">filewriter.writerow(header)</span><br><span class="line"></span><br><span class="line"># 查询Suppliers表，并将结果写入CSV输出文件</span><br><span class="line">c.execute(&quot;&quot;&quot;SELECT *</span><br><span class="line">             FROM Suppliers</span><br><span class="line">             WHERE Cost &gt; 700.0;&quot;&quot;&quot;)</span><br><span class="line">rows = c.fetchall()</span><br><span class="line">for row in rows:</span><br><span class="line">    filewriter.writerow(row)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到CSV输出文件。<br><img src="https://img-blog.csdnimg.cn/20200211181715793.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="更新表中记录"><a href="#更新表中记录" class="headerlink" title="更新表中记录"></a>更新表中记录</h2><p>&emsp;&emsp;更新表中记录的方法与之前的插入新记录的方法类似，只是SQL语句有所变化，将<code>INSERT</code>语句变为了<code>UPDATE</code>语句。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import MySQLdb</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"># CSV输入文件的路径和文件名</span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line"></span><br><span class="line"># 连接MySQL数据库</span><br><span class="line">con = MySQLdb.connect(host=&apos;localhost&apos;, port=3306, db=&apos;my_suppliers&apos;, user=&apos;root&apos;, passwd=&apos;## your password ##&apos;)</span><br><span class="line">c = con.cursor()</span><br><span class="line"></span><br><span class="line"># 读取CSV文件并更新特定的行</span><br><span class="line">file_reader = csv.reader(open(input_file, &apos;r&apos;, newline=&apos;&apos;), delimiter=&apos;,&apos;)</span><br><span class="line">header = next(file_reader, None)</span><br><span class="line">for row in file_reader:</span><br><span class="line">    data = []</span><br><span class="line">    for column_index in range(len(header)):</span><br><span class="line">        data.append(str(row[column_index]).strip())</span><br><span class="line">    print(data)</span><br><span class="line">    c.execute(&quot;&quot;&quot;UPDATE Suppliers SET Cost=%s, Purchase_Date=%s WHERE Supplier_Name=%s;&quot;&quot;&quot;, data)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"># 查询Suppliers表</span><br><span class="line">c.execute(&quot;SELECT * FROM Suppliers&quot;)</span><br><span class="line">rows = c.fetchall()</span><br><span class="line">for row in rows:</span><br><span class="line">    output = []</span><br><span class="line">    for column_index in range(len(row)):</span><br><span class="line">        output.append(str(row[column_index]))</span><br><span class="line">    print(output)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在<code>UPDATE</code>语句中，必须指定想要更新哪一条记录和哪一个列属性。在这里，我们想为一组特定的Supplier Names更新Cost值和Purchase Date值。<code>UPDATE</code>语句中需要几个值，就需要几个<code>%s</code>占位符表示出查询中的值的位置，CSV输入文件中数据的顺序也要同查询中属性的顺序一样。<br>&emsp;&emsp;现在我们新建一个CSV输入文件：<br><img src="https://img-blog.csdnimg.cn/20200211204909672.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出结果如下：<br><img src="https://img-blog.csdnimg.cn/20200211205045296.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;输出结果的前两行展示了来自于CSV输入文件中除标题行之外的两行数据。在这两行下面，输出展示了执行更新之后从数据表中取出的12行数据，每行数据占一行。<br>&emsp;&emsp;下面我们来确认一下MySQL数据表中与Supplier X和Supplier Y相关的8行数据是否已被更新。打开MySQL命令行客户端，输入命令<code>SELECT * FROM Suppliers</code>，然后按Enter键。<br><img src="https://img-blog.csdnimg.cn/2020021120553321.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;下面的表格是更新后的数据表。这里我截取了本次和上一次的数据表，为的是有一个明显的对比。我们看到，Supplier X和Supplier Y相关的8行记录已经被更新为CSV输入文件中提供的数据。  </p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/11/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%BA%93(2)/">
                Python数据分析基础之数据库(2)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-11</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>&emsp;&emsp;上一篇博客主要讲了使用Python的内置模块sqlite3来创建内存数据库，这篇博客以及之后的博客主要讲MySQL数据库。  </p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>&emsp;&emsp;我们需要安装Python的MySQLdb扩展包，在Python 2中是MySQL-python，在Python 3中是mysqlclient。我使用的是Anaconda，这个扩展包随着安装Anaconda的时候就捆绑安装好了。<br>&emsp;&emsp;我们还需要安装MySQL。msi版安装教程可以参考我之前写的博客：<a href="https://blog.csdn.net/qq_45554010/article/details/104254892" target="_blank" rel="noopener">《MySQL Community 8.0.19.0 msi版安装教程》</a>，zip版安装教程请自行查阅。  </p>
<h2 id="在MySQL中创建新数据库"><a href="#在MySQL中创建新数据库" class="headerlink" title="在MySQL中创建新数据库"></a>在MySQL中创建新数据库</h2><p>&emsp;&emsp;打开MySQL 8.0 Command Line Client，输入root密码，进入MySQL。<br><img src="https://img-blog.csdnimg.cn/20200211113356992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;输入命令<code>SHOW DATABASES;</code>，然后按Enter键，我们可以看到，在MySQL数据库系统中已经有了4个数据库。这些数据库使MySQL数据库系统能够运行，并包含系统用户的权限信息。注意：在输入命令<code>SHOW DATABASES;</code>的时候，<strong>必须要输入分号</strong>。<br><img src="https://img-blog.csdnimg.cn/20200211113838267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;接下来我们来创建自己的数据库。输入命令<code>CREATE DATABASE my_suppliers;</code>，然后按Enter键。我们可以再运行一次<code>SHOW DATABASE;</code>命令，这时我们可以看到我们刚刚创建的<code>my_suppliers</code>数据库。<br><img src="https://img-blog.csdnimg.cn/20200211114219439.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;要使用<code>my_suppliers</code>数据库，必须先选择它。输入命令<code>USE my_suppliers;</code>，然后按Enter键。这样我们就已经选择了<code>my_suppliers</code>数据库。<br><img src="https://img-blog.csdnimg.cn/20200211114436643.png" alt="在这里插入图片描述"></p>
<p>&emsp;&emsp;接下来我们创建一个数据表<code>Suppliers</code>。输入以下命令，然后按Enter键：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS Suppliers</span><br><span class="line">(Supplier_Name VARCHAR(20),</span><br><span class="line">Invoice_Number VARCHAR(20),</span><br><span class="line">Part_Number VARCHAR(20),</span><br><span class="line">Cost FLOAT,</span><br><span class="line">Purchase_Date DATE);</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200211114912180.png" alt="在这里插入图片描述"></p>
<p>&emsp;&emsp;我们来解释一下上面的命令。<br>&emsp;&emsp;如果数据库中不存在数据表<code>Suppliers</code>，这个命令就创建数据表<code>Suppliers</code>。这个表有5个列。其中，前3个列是可变字符<code>VARCHAR</code>型字段。<code>20</code>表示为这个字段中的数据分配20个字符。如果输入这个字段的数据大于20个字符，那么数据将被截断。如果数据少于20个字符，那么这个字段就为数据分配一个更小的空间。<br>&emsp;&emsp;第4列是一个浮点数<code>FLOAT</code>字段。浮点数字段保存浮点数近似值。在本例中，第4列包含的是货币值，所以可以用<code>NUMERIC</code>定点确定值类型字段替代<code>FLOAT</code>类型字段。不使用<code>FLOAT</code>，也可以使用<code>NUMERIC(11, 2)</code>。其中<code>11</code>是数值的精度，也就是为数值保存的数位总数（包括小数点后面的位数）。<code>2</code>是小数位数，即小数点后面的数位总数。<br>&emsp;&emsp;第5列是一个日期<code>DATE</code>字段。<code>DATE</code>字段用来保存日期，形式为<code>YYYY-MM-DD</code>，没有时间部分。<br>&emsp;&emsp;为了确保数据表创建正确，输入命令<code>DESCRIBE Suppliers;</code>，然后按Enter键。<br><img src="https://img-blog.csdnimg.cn/20200211120009829.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;我们看到了一个表格，其中列出了创建的列的名称，每列的数据类型以及列中的值是否可以为<code>NULL</code>。<br>&emsp;&emsp;接下来我们创建一个新用户。输入命令<code>CREATE USER &#39;username&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;secret_password&#39;;</code>（请注意用要使用的用户名替换<code>username</code>，用自己的密码替换<code>secret_password</code>），然后按Enter键。<br>&emsp;&emsp;输入以下两条命令，然后在每条命令后面按Enter键，来向新用户授于所有权限。同样地，用要使用的用户名替换下面的<code>username</code>。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON my_suppliers.* TO &apos;username&apos;@&apos;localhost&apos;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这样我们就可以同本地主机中的<code>my_suppliers</code>数据库中的<code>Suppliers</code>表进行交互了。<br><img src="https://img-blog.csdnimg.cn/20200211162149574.png" alt="在这里插入图片描述"></p>
<h2 id="向表中插入新记录"><a href="#向表中插入新记录" class="headerlink" title="向表中插入新记录"></a>向表中插入新记录</h2><p>&emsp;&emsp;下面的Python脚本会将数据从CSV文件中插入到我们的数据表，然后展示表中的数据。我们还是以supplier_data.csv为例。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import MySQLdb</span><br><span class="line">import sys</span><br><span class="line">from datetime import datetime, date</span><br><span class="line"></span><br><span class="line"># CSV输入文件的路径和文件名</span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line"></span><br><span class="line"># 连接MySQL数据库</span><br><span class="line">con = MySQLdb.connect(host=&apos;localhost&apos;, port=3306, db=&apos;my_suppliers&apos;, user=&apos;root&apos;, passwd=&apos;## your password ##&apos;)</span><br><span class="line">c = con.cursor()</span><br><span class="line"></span><br><span class="line"># 向Suppliers表中插入数据</span><br><span class="line">file_reader = csv.reader(open(input_file, &apos;r&apos;, newline=&apos;&apos;))</span><br><span class="line">header = next(file_reader)</span><br><span class="line">for row in file_reader:</span><br><span class="line">    data = []</span><br><span class="line">    for column_index in range(len(header)):</span><br><span class="line">        if column_index &lt; 4:</span><br><span class="line">            data.append(str(row[column_index]).lstrip(&apos;$&apos;).replace(&apos;,&apos;, &apos;&apos;).strip())</span><br><span class="line">        else:</span><br><span class="line">            a_date = datetime.date(datetime.strptime(str(row[column_index]), &apos;%m/%d/%Y&apos;))</span><br><span class="line">            a_date = a_date.strftime(&apos;%Y-%m-%d&apos;)</span><br><span class="line">            data.append(a_date)</span><br><span class="line">    print(data)</span><br><span class="line">    c.execute(&quot;&quot;&quot;INSERT INTO Suppliers VALUES (%s, %s, %s, %s, %s);&quot;&quot;&quot;, data)</span><br><span class="line">con.commit()</span><br><span class="line">print(&quot;&quot;)</span><br><span class="line"></span><br><span class="line"># 查询Suppliers表</span><br><span class="line">c.execute(&quot;SELECT * FROM Suppliers&quot;)</span><br><span class="line">rows = c.fetchall()</span><br><span class="line">for row in rows:</span><br><span class="line">    row_list_output = []</span><br><span class="line">    for column_index in range(len(row)):</span><br><span class="line">        row_list_output.append(str(row[column_index]))</span><br><span class="line">    print(row_list_output)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第12行代码使用MySQLdb模块的<code>connect()</code>方法连接<code>my_suppliers</code>，即前面我们创建的MySQL数据库。在连接时，我们需要指定一些通用参数。<code>host</code>是数据库所在的机器的主机名，在这里，MySQL服务器保存在我们的计算机上，所以<code>host</code>是<code>localhost</code>。<code>port</code>是MySQL服务器的TCP/IP连接端口号，这里我们使用的端口号是默认的端口号3306。<code>db</code>是想要连接的数据库名称。<code>user</code>是进行数据库连接的用户的用户名，<code>passwd</code>即为密码。在这里我们作为“root”用户进行连接，使用的密码就是在安装MySQL服务器时创建的密码。我们此前新建了一个新用户，如果想使用新用户，我们只需要把用户名和密码相应地替换掉即可。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，得到输出结果。<br><img src="https://img-blog.csdnimg.cn/20200211162509331.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;这个输出结果证明了数据被成功地加载到了<code>Suppliers</code>表中，并被成功读出。<br>&emsp;&emsp;我们打开MySQL命令行客户端，输入命令<code>SELECT * FROM Suppliers;</code>，可以看到一个表格，其中列出了<code>Suppliers</code>数据表中所有的列以及每列中的12行数据。<br><img src="https://img-blog.csdnimg.cn/20200211162818607.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/10/MySQL%20Community%208.0.19.0%20msi%E7%89%88%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/">
                MySQL Community 8.0.19.0 msi版安装教程
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-10</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="1-在MySQL官网中下载msi文件"><a href="#1-在MySQL官网中下载msi文件" class="headerlink" title="1.在MySQL官网中下载msi文件"></a>1.在MySQL官网中下载msi文件</h3><p>下载地址：<a href="https://dev.mysql.com/downloads/windows/installer/8.0.html" target="_blank" rel="noopener">https://dev.mysql.com/downloads/windows/installer/8.0.html</a><br><img src="https://img-blog.csdnimg.cn/2020021021112714.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">如上图所示，下载第二个即可。<strong>这里需要说明的一点是，虽然这里的MySQL Installer是32位，但会同时安装32位和64位二进制文件。</strong>  </p>
<h3 id="2-打开下载好的msi文件进行安装"><a href="#2-打开下载好的msi文件进行安装" class="headerlink" title="2.打开下载好的msi文件进行安装"></a>2.打开下载好的msi文件进行安装</h3><p>2.1 选择Custom，点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210211604540.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.2 将MySQL Server 8.0.19 - X64移动到右侧，如下图所示。点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210211645436.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.3 点击Execute。<br><img src="https://img-blog.csdnimg.cn/20200210211747522.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.4 短暂等待后，点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210211812888.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.5 点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210211854223.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.6 点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210211914480.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.7 点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210211930403.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.8 点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210211953438.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.9 设置root密码，<strong>root密码一定要牢记</strong>！！！记性不好的可以把它存在手机的备忘录里哦~设置完成后点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210212028836.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.10 点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210212326273.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.11 点击Execute。<br><img src="https://img-blog.csdnimg.cn/20200210212424191.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>短暂等待之后，这七个白色的小圆圈都变成绿色了，如下图所示。点击Finish。<br><img src="https://img-blog.csdnimg.cn/20200210212514831.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.12 点击Next。<br><img src="https://img-blog.csdnimg.cn/20200210212540832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.13 点击Finish完成安装。<br><img src="https://img-blog.csdnimg.cn/20200210212604571.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="3-检验是否安装成功"><a href="#3-检验是否安装成功" class="headerlink" title="3.检验是否安装成功"></a>3.检验是否安装成功</h3><p>打开开始菜单，我们会发现MySQL文件夹，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200210212653834.png" alt="在这里插入图片描述"></p>
<p>打开MySQL 8.0 Command Line Client，输入此前设置的root密码，如下图所示。这样即为安装成功。<br><img src="https://img-blog.csdnimg.cn/20200210212838937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/10/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%BA%93(1)/">
                Python数据分析基础之数据库(1)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-10</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>&emsp;&emsp;SQL（Structured Query Language），表示结构化查询语言，是一组应用广泛的与数据库交互的命令。要学习如何使用Python同数据库交互，首先我们要有一个数据库，并且数据库中要有一张充满数据的表。有两种资源可供我们选择：一是Python的内置模块sqlite3，它可以创建内存数据库，我们不用下载安装专门的数据库软件；二是MySQL、PostgreSQL或Oracle这样的常用数据库系统。  </p>
<h2 id="使用sqlite3模块创建数据库"><a href="#使用sqlite3模块创建数据库" class="headerlink" title="使用sqlite3模块创建数据库"></a>使用sqlite3模块创建数据库</h2><p>&emsp;&emsp;首先，我们使用sqlite3模块直接在Python代码中创建一个内存数据库以及充满了数据的表。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sqlite3</span><br><span class="line"></span><br><span class="line"># 创建SQLite3内存数据库</span><br><span class="line"># 创建带有4个属性的sales表</span><br><span class="line">con = sqlite3.connect(&apos;:memory:&apos;)</span><br><span class="line">query = &quot;&quot;&quot;CREATE TABLE sales</span><br><span class="line">           (customer VARCHAR(20),</span><br><span class="line">           product VARCHAR(40),</span><br><span class="line">           amount FLOAT,</span><br><span class="line">           date DATE);&quot;&quot;&quot;</span><br><span class="line">con.execute(query)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"># 在表中插入几行数据</span><br><span class="line">data = [(&apos;Richard Lucas&apos;, &apos;Notepad&apos;, 2.50, &apos;2014-01-02&apos;),</span><br><span class="line">        (&apos;Jenny Kim&apos;, &apos;Binder&apos;, 4.15, &apos;2014-01-15&apos;),</span><br><span class="line">        (&apos;Svetlana Crow&apos;, &apos;Printer&apos;, 155.75, &apos;2014-02-03&apos;),</span><br><span class="line">        (&apos;Stephen Randolph&apos;, &apos;Computer&apos;, 679.40, &apos;2014-02-20&apos;)]</span><br><span class="line">statement = &quot;INSERT INTO sales VALUES(?, ?, ?, ?)&quot;</span><br><span class="line">con.executemany(statement, data)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"># 查询sales表</span><br><span class="line">cursor = con.execute(&quot;SELECT * FROM sales&quot;)</span><br><span class="line">rows = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"># 计算查询结果中行的数量</span><br><span class="line">row_counter = 0</span><br><span class="line">for row in rows:</span><br><span class="line">    print(row)</span><br><span class="line">    row_counter += 1</span><br><span class="line">print(&apos;Number of rows: %d&apos; % (row_counter))</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第3行代码导入了sqlite3模块。为了使用这个模块，首先必须创建一个代表数据库的连接对象。第7行代码创建了连接对象<code>con</code>来代表数据库。专用名称<code>&#39;:memory:&#39;</code>在内存中创建了一个数据库。如果想要数据库持久化，就需要提供另外的字符串。<br>&emsp;&emsp;第8-12行代码使用三重双引号创建了一个多行字符串，并将这个字符串赋给变量<code>query</code>。这个字符串是一个SQL命令，可以在数据库中创建一个名为<code>sales</code>的表。<code>sales</code>表有4个属性：<code>customer</code>, <code>product</code>, <code>amount</code>和<code>date</code>。<code>customer</code>和<code>product</code>都是变长字符型字段，最大字符数分别为20和40。<code>amount</code>是一个浮点数型字段。<code>date</code>是一个日期型字段。<br>&emsp;&emsp;第13行代码使用连接对象的<code>execute()</code>方法执行包含在变量<code>query</code>中的SQL命令，在内存数据库中创建<code>sales</code>表。第14行代码使用连接对象的<code>commit()</code>方法将修改提交（也就是保存）到数据库。对数据库做出修改时必须使用<code>commit()</code>方法保存修改。<br>&emsp;&emsp;第21行代码与第8行代码类似，创建了一个字符串并赋给变量<code>statement</code>。这行代码中的字符串是另一个SQL命令，<code>INSERT</code>语句可以将<code>data</code>中的数据行插入<code>sales</code>表。<code>?</code>在这里用作占位符，表示想在SQL命令中使用的值。然后，在连接对象的<code>execute()</code>或<code>executemany()</code>方法中，需要提供一个包含4个值的元组，元组中的值会按位置替换到SQL命令中。<br>&emsp;&emsp;第26行代码使用连接对象的<code>execute()</code>方法运行一条SQL命令，并将命令结果赋给一个光标变量<code>cursor</code>。第27行代码执行了<code>fetchall()</code>方法，返回第26行代码中的SQL命令的数据行的列表。每行数据都是一个元组，所以<code>rows</code>是一个元组列表。在这种情况下，<code>sales</code>表中包含4行数据，SQL命令从<code>sales</code>表中选择所有的行，所以<code>rows</code>是一个含有4个元组的列表。<br>&emsp;&emsp;运行结果如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(&apos;Richard Lucas&apos;, &apos;Notepad&apos;, 2.5, &apos;2014-01-02&apos;)</span><br><span class="line">(&apos;Jenny Kim&apos;, &apos;Binder&apos;, 4.15, &apos;2014-01-15&apos;)</span><br><span class="line">(&apos;Svetlana Crow&apos;, &apos;Printer&apos;, 155.75, &apos;2014-02-03&apos;)</span><br><span class="line">(&apos;Stephen Randolph&apos;, &apos;Computer&apos;, 679.4, &apos;2014-02-20&apos;)</span><br><span class="line">Number of rows: 4</span><br></pre></td></tr></table></figure>
<h2 id="向表中插入新记录"><a href="#向表中插入新记录" class="headerlink" title="向表中插入新记录"></a>向表中插入新记录</h2><p>&emsp;&emsp;下面的这个脚本将创建一个数据表，向表中插入CSV文件中的数据，然后展示表中的数据。这里使用的CSV文件是前面用到过的supplier_data.csv文件。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import sqlite3</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"># CSV输入文件的路径和文件名</span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line"></span><br><span class="line"># 创建SQLite3内存数据库</span><br><span class="line"># 创建带有5个属性的Suppliers表</span><br><span class="line">con = sqlite3.connect(&apos;E:\\python_pycharm\\Python数据分析基础\\第4章 数据库\\Suppliers.db&apos;)</span><br><span class="line">c = con.cursor()</span><br><span class="line">create_table = &quot;&quot;&quot;CREATE TABLE IF NOT EXISTS Suppliers</span><br><span class="line">                  (Supplier_Name VARCHAR(20),</span><br><span class="line">                  Invoice_Number VARCHAR(20),</span><br><span class="line">                  Part_Number VARCHAR(20),</span><br><span class="line">                  Cost FLOAT,</span><br><span class="line">                  Purchase_Date DATE);&quot;&quot;&quot;</span><br><span class="line">c.execute(create_table)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"># 读取CSV文件</span><br><span class="line"># 向Suppliers表中插入数据</span><br><span class="line">file_reader = csv.reader(open(input_file, &apos;r&apos;), delimiter=&apos;,&apos;)</span><br><span class="line">header = next(file_reader, None)</span><br><span class="line">for row in file_reader:</span><br><span class="line">    data = []</span><br><span class="line">    for column_index in range(len(header)):</span><br><span class="line">        data.append(row[column_index])</span><br><span class="line">    print(data)</span><br><span class="line">    c.execute(&quot;INSERT INTO Suppliers VALUES (?, ?, ?, ?, ?);&quot;, data)</span><br><span class="line">con.commit()</span><br><span class="line">print(&apos;&apos;)</span><br><span class="line"></span><br><span class="line"># 查询Suppliers表</span><br><span class="line">output = c.execute(&quot;SELECT * FROM Suppliers&quot;)</span><br><span class="line">rows = output.fetchall()</span><br><span class="line">for row in rows:</span><br><span class="line">    output = []</span><br><span class="line">    for column_index in range(len(row)):</span><br><span class="line">        output.append(str(row[column_index]))</span><br><span class="line">    print(output)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第12行代码为本地数据库<code>Suppliers.db</code>创建连接。这是一个持久化数据库，即使重启计算机，这个数据库也不会被删除。<br>&emsp;&emsp;第25-33行代码从CSV输入文件中读取要加载到数据库中的数据，并对输入文件中的每行数据执行一条SQL语句，将数据插入到数据库的表中。第32行代码将每行数据加载到数据表中。第33行代码使用<code>commit()</code>方法将修改提交到数据库。<br>&emsp;&emsp;第37-43行代码从数据表<code>Suppliers</code>中选择所有数据，并将输出打印到命令行窗口。第37-38行代码执行一条SQL语句，从<code>Suppliers</code>表中选择所有数据，并将<code>output</code>中的所有行读入变量<code>rows</code>。<br>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出结果如下：<br><img src="https://img-blog.csdnimg.cn/2020021019311438.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;输出的第一部分是从CSV文件中解析出的数据行，输出的第二部分是同样的行，但它是从sqlite数据表中提取出来的。  </p>
<h2 id="更新表中记录"><a href="#更新表中记录" class="headerlink" title="更新表中记录"></a>更新表中记录</h2><p>&emsp;&emsp;我们可以使用CSV输入文件向数据表中添加新行，也可以使用从CSV输入文件中读取数据的技术来更新表中已有的行。在这种情况下，SQL语句有所改变，从<code>INSERT</code>语句变成了<code>UPDATE</code>语句。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import sqlite3</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"># CSV输入文件的路径和文件名</span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line"></span><br><span class="line"># 创建SQLite3内存数据库</span><br><span class="line"># 创建带有4个属性的sales表</span><br><span class="line">con = sqlite3.connect(&apos;:memory:&apos;)</span><br><span class="line">query = &quot;&quot;&quot;CREATE TABLE IF NOT EXISTS sales</span><br><span class="line">           (customer VARCHAR(20),</span><br><span class="line">           product VARCHAR(40),</span><br><span class="line">           amount FLOAT,</span><br><span class="line">           date DATE);&quot;&quot;&quot;</span><br><span class="line">con.execute(query)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"># 向表中插入几行数据</span><br><span class="line">data = [(&apos;Richard Lucas&apos;, &apos;Notepad&apos;, 2.50, &apos;2014-01-02&apos;),</span><br><span class="line">        (&apos;Jenny Kim&apos;, &apos;Binder&apos;, 4.15, &apos;2014-01-15&apos;),</span><br><span class="line">        (&apos;Svetlana Crow&apos;, &apos;Printer&apos;, 155.75, &apos;2014-02-03&apos;),</span><br><span class="line">        (&apos;Stephen Randolph&apos;, &apos;Computer&apos;, 679.40, &apos;2014-02-20&apos;)]</span><br><span class="line">for tuple in data:</span><br><span class="line">    print(tuple)</span><br><span class="line">statement = &quot;INSERT INTO sales VALUES(?, ?, ?, ?)&quot;</span><br><span class="line">con.executemany(statement, data)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"># 读取CSV文件并更新特定的行</span><br><span class="line">file_reader = csv.reader(open(input_file, &apos;r&apos;), delimiter=&apos;,&apos;)</span><br><span class="line">header = next(file_reader, None)</span><br><span class="line">for row in file_reader:</span><br><span class="line">    data = []</span><br><span class="line">    for column_index in range(len(header)):</span><br><span class="line">        data.append(row[column_index])</span><br><span class="line">    print(data)</span><br><span class="line">    con.execute(&quot;UPDATE sales SET amount=?, date=? WHERE customer=?;&quot;, data)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"># 查询sales表</span><br><span class="line">cursor = con.execute(&quot;SELECT * FROM sales&quot;)</span><br><span class="line">rows = cursor.fetchall()</span><br><span class="line">for row in rows:</span><br><span class="line">    output = []</span><br><span class="line">    for column_index in range(len(row)):</span><br><span class="line">        output.append(str(row[column_index]))</span><br><span class="line">    print(output)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第40行代码，<code>UPDATE</code>语句代替了原来的<code>INSERT</code>语句。在<code>UPDATE</code>语句中，我们必须指定想更新哪一条记录和哪一个列属性。在这里，我们想为一组特定的<code>customer</code>更新<code>amount</code>值和<code>date</code>值。像前面的示例一样，<code>UPDATE</code>语句也需要占位符表示查询中的值的位置，CSV输入文件中数据的顺序也要同查询中属性的顺序一样。<br>&emsp;&emsp;我们新建一个CSV输入文件：<br><img src="https://img-blog.csdnimg.cn/20200210202106745.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;在命令行窗口中运行这个脚本，得到下面的输出结果。<br><img src="https://img-blog.csdnimg.cn/20200210202147190.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;这个输出首先展示了数据库中初始的4行数据，接下来2行是要更新到数据库中的2行数据。在这2行下面，输出还展示了执行更新之后从数据表中取出的4行数据。  </p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/10/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(6)/">
                Python数据分析基础之Excel文件(6)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-10</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>&emsp;&emsp;这一篇博客主要讲一下处理多个工作簿。<br>&emsp;&emsp;之前我们已经创建了sales_2013.xlsx工作簿。在这里，我们再创建两个新的工作簿sales_2014.xlsx和sales_2015.xlsx，并且修改其中的工作表名称和日期数据。<br><img src="https://img-blog.csdnimg.cn/20200210084609347.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200210084620268.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200210084629291.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200210084650308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/2020021008473444.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/2020021008481770.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="工作表计数以及每个工作表中的行列计数"><a href="#工作表计数以及每个工作表中的行列计数" class="headerlink" title="工作表计数以及每个工作表中的行列计数"></a>工作表计数以及每个工作表中的行列计数</h2><p>&emsp;&emsp;如果想知道一个文件夹中工作簿的数量，每个工作簿中工作表的数量，以及每个工作表中的行与列的数量，我们可以编写下面的代码：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import glob</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">from xlrd import open_workbook</span><br><span class="line"></span><br><span class="line">input_directory = sys.argv[1]</span><br><span class="line"></span><br><span class="line">workbook_counter = 0</span><br><span class="line">for input_file in glob.glob(os.path.join(input_directory, &apos;*.xlsx&apos;)):</span><br><span class="line">    workbook = open_workbook(input_file)</span><br><span class="line">    print(&apos;Workbook: %s&apos; % os.path.basename(input_file))</span><br><span class="line">    print(&apos;Number of worksheets: %d&apos; % workbook.nsheets)</span><br><span class="line">    for worksheet in workbook.sheets():</span><br><span class="line">        print(&apos;Worksheet name: &apos;, worksheet.name, &apos;\tRows: &apos;, worksheet.nrows, &apos;\tColumns: &apos;, worksheet.ncols)</span><br><span class="line">    workbook_counter += 1</span><br><span class="line">print(&apos;Number of Excel workbooks: %d&apos; % (workbook_counter))</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这和之前的内省单个工作簿的代码非常相似。我们在命令行窗口中运行这个脚本，得到下面的输出结果。<br><img src="https://img-blog.csdnimg.cn/20200210085206136.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="从多个工作簿中连接数据"><a href="#从多个工作簿中连接数据" class="headerlink" title="从多个工作簿中连接数据"></a>从多个工作簿中连接数据</h2><p>&emsp;&emsp;使用Python可以将多个工作簿中所有工作表的数据垂直连接成一个输出文件。  </p>
<h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import glob</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_folder = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;all_data_all_workbooks&apos;, cell_overwrite_ok=True)</span><br><span class="line">data = []</span><br><span class="line">first_worksheet = True</span><br><span class="line">for input_file in glob.glob(os.path.join(input_folder, &apos;*.xlsx&apos;)):</span><br><span class="line">    print(os.path.basename(input_file))</span><br><span class="line">    with open_workbook(input_file) as workbook:</span><br><span class="line">        for worksheet in workbook.sheets():</span><br><span class="line">            if first_worksheet:</span><br><span class="line">                header_row = worksheet.row_values(0)</span><br><span class="line">                data.append(header_row)</span><br><span class="line">                first_worksheet = False</span><br><span class="line">            for row_index in range(1, worksheet.nrows):</span><br><span class="line">                row_list = []</span><br><span class="line">                for column_index in range(worksheet.ncols):</span><br><span class="line">                    cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                    cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                    if cell_type == 3:</span><br><span class="line">                        date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                        date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                        row_list.append(date_cell)</span><br><span class="line">                    else:</span><br><span class="line">                        row_list.append(cell_value)</span><br><span class="line">                data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>作者注：在第14行代码中，参考书上的代码并没有’cell_overwrite_ok=True’这一参数，这是我在写代码的时候报错后自己加上去的。<br>报错信息如下：<br>Traceback (most recent call last):<br>  File “E:\python_pycharm\Python数据分析基础\第3章 Excel文件\13excel_concat_data_from_multiple_workbook.py”, line 39, in <module><br>    output_worksheet.write(list_index, element_index, element)<br>  File “D:\Anaconda3\lib\site-packages\xlwt\Worksheet.py”, line 1088, in write<br>    self.row(r).write(c, label, style)<br>  File “D:\Anaconda3\lib\site-packages\xlwt\Row.py”, line 235, in write<br>    StrCell(self.<strong>idx, col, style_index, self.</strong>parent_wb.add_str(label))<br>  File “D:\Anaconda3\lib\site-packages\xlwt\Row.py”, line 154, in insert_cell<br>    raise Exception(msg)<br>Exception: Attempt to overwrite cell: sheetname=’all_data_all_workbooks’ rowx=0 colx=0<br>查阅有关资料后得知，对一个单元格重复操作会引发ReturnsError，这个时候只要在打开文件的时候加上’cell_overwrite_ok=True’即可解决。这应该是书本上的错误。  </p>
</blockquote>
<p>&emsp;&emsp;在命令行窗口中运行这个代码，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200210093005610.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200210093047339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;pandas模块提供了<code>concat()</code>函数来连接数据框。如果想把数据框一个一个地垂直堆叠起来，需要设置参数<code>axis=0</code>；如果想把数据框一个一个地平行连接起来，需要设置参数<code>axis=1</code>。如果我们需要基于某个关键字列连接数据框，可以使用pandas模块的<code>merge()</code>函数。<br>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import glob</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_path = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">all_workbooks = glob.glob(os.path.join(input_path, &apos;*.xlsx&apos;))</span><br><span class="line">data_frames = []</span><br><span class="line">for workbook in all_workbooks:</span><br><span class="line">    all_worksheets = pd.read_excel(workbook, sheet_name=None, index_col=None)</span><br><span class="line">    for worksheet_name, data in all_worksheets.items():</span><br><span class="line">        data_frames.append(data)</span><br><span class="line">all_data_concatenated = pd.concat(data_frames, axis=0, ignore_index=True)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">all_data_concatenated.to_excel(writer, sheet_name=&apos;all_data_all_workbooks&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200210093549770.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="为每个工作簿和工作表计算总数和均值"><a href="#为每个工作簿和工作表计算总数和均值" class="headerlink" title="为每个工作簿和工作表计算总数和均值"></a>为每个工作簿和工作表计算总数和均值</h2><h4 id="基础Python"><a href="#基础Python" class="headerlink" title="基础Python"></a>基础Python</h4><p>&emsp;&emsp;代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import glob</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_folder = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;sums_and_averages&apos;)</span><br><span class="line">all_data = []</span><br><span class="line">sales_column_index = 3</span><br><span class="line">header = [&apos;workbook&apos;, &apos;worksheet&apos;, &apos;worksheet_total&apos;, &apos;worksheet_average&apos;, &apos;workbook_total&apos;, &apos;workbook_average&apos;]</span><br><span class="line">all_data.append(header)</span><br><span class="line">for input_file in glob.glob(os.path.join(input_folder, &apos;*.xlsx&apos;)):</span><br><span class="line">    with open_workbook(input_file) as workbook:</span><br><span class="line">        list_of_totals = []</span><br><span class="line">        list_of_numbers = []</span><br><span class="line">        workbook_output = []</span><br><span class="line">        for worksheet in workbook.sheets():</span><br><span class="line">            total_sales = 0</span><br><span class="line">            number_of_sales = 0</span><br><span class="line">            worksheet_list = []</span><br><span class="line">            worksheet_list.append(os.path.basename(input_file))</span><br><span class="line">            worksheet_list.append(worksheet.name)</span><br><span class="line">            for row_index in range(1, worksheet.nrows):</span><br><span class="line">                try:</span><br><span class="line">                    total_sales += float(str(worksheet.cell_value(row_index, sales_column_index))</span><br><span class="line">                                         .strip(&apos;$&apos;).replace(&apos;,&apos;, &apos;&apos;))</span><br><span class="line">                    number_of_sales += 1</span><br><span class="line">                except:</span><br><span class="line">                    total_sales += 0</span><br><span class="line">                    number_of_sales += 0</span><br><span class="line">            average_sales = &apos;%.2f&apos; % (total_sales / number_of_sales)</span><br><span class="line">            worksheet_list.append(total_sales)</span><br><span class="line">            worksheet_list.append(float(average_sales))</span><br><span class="line">            list_of_totals.append(total_sales)</span><br><span class="line">            list_of_numbers.append(float(number_of_sales))</span><br><span class="line">            workbook_output.append(worksheet_list)</span><br><span class="line">        workbook_total = sum(list_of_totals)</span><br><span class="line">        workbook_average = sum(list_of_totals) / sum(list_of_numbers)</span><br><span class="line">        for list_element in workbook_output:</span><br><span class="line">            list_element.append(workbook_total)</span><br><span class="line">            list_element.append(workbook_average)</span><br><span class="line">        all_data.extend(workbook_output)</span><br><span class="line"></span><br><span class="line">for list_index, output_list in enumerate(all_data):</span><br><span class="line">    for element_index, element in enumerate(output_list):</span><br><span class="line">        output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第21-23行分别创建了3个空列表，<code>list_of_totals</code>用来保存工作簿中所有工作表的销售额总计，<code>list_of_numbers</code>用来保存工作簿的所有工作表中用来计算总销售额的销售额数据个数，<code>workbook_output</code>用来保存要写入输出文件的所有输出列表。<br>&emsp;&emsp;第27行代码创建了列表<code>worksheet_list</code>，用来保存要保留的所有工作表的信息。<br>&emsp;&emsp;第28-29行代码将工作簿名称和工作表名称追加到<code>worksheet_list</code>中。同样地，第39-40行代码将销售额总计和均值追加到<code>worksheet_list</code>中，第43行代码将<code>worksheet_list</code>追加到<code>workbook_output</code>中，在工作簿级别保存信息。<br>&emsp;&emsp;第41-42行代码将工作表的销售额总计和销售额数据个数分别追加到<code>list_of_totals</code>和<code>list_of_numbers</code>中，这样我们可以对所有工作表保存这些值。<br>&emsp;&emsp;当获得了所有要为工作簿保留的信息之后，就将这些列表扩展到<code>all_data</code>中。这里使用<code>extend()</code>而不是<code>append()</code>，以使<code>workbook_output</code>中的每个列表都会成为<code>all_data</code>中的一个独立元素。在处理完所有工作簿之后，<code>all_data</code>是一个具有9个元素的列表，每个元素都是一个列表。否则，如果使用<code>append()</code>，<code>all_data</code>中就会只有3个元素，每个元素都是一个列表的列表。<br>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200210144814305.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/09/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(5)/">
                Python数据分析基础之Excel文件(5)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-09</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>&emsp;&emsp;上一篇博客主要讲了如何在一个工作簿的所有工作表中筛选特定的行和列。但是，有些情况下，我们只需要处理工作簿中其中几个工作表。在这种情况下，我们可以使用<code>sheet_by_index()</code>或<code>sheet_by_name()</code>函数来处理这些待处理的工作表。  </p>
<h2 id="在一组工作表中筛选特定行"><a href="#在一组工作表中筛选特定行" class="headerlink" title="在一组工作表中筛选特定行"></a>在一组工作表中筛选特定行</h2><h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;我们想要筛选出sales_2013.xlsx这个工作簿的第一个和第二个工作表中销售额大于$1900.00的那些行。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;set_of_worksheets&apos;)</span><br><span class="line">my_sheets = [0, 1]</span><br><span class="line">threshold = 1900.0</span><br><span class="line">sales_column_index = 3</span><br><span class="line">first_worksheet = True</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    data = []</span><br><span class="line">    for sheet_index in range(workbook.nsheets):</span><br><span class="line">        if sheet_index in my_sheets:</span><br><span class="line">            worksheet = workbook.sheet_by_index(sheet_index)</span><br><span class="line">            if first_worksheet:</span><br><span class="line">                header_row = worksheet.row_values(0)</span><br><span class="line">                data.append(header_row)</span><br><span class="line">                first_worksheet = False</span><br><span class="line">            for row_index in range(1, worksheet.nrows):</span><br><span class="line">                row_list = []</span><br><span class="line">                sale_amount = worksheet.cell_value(row_index, sales_column_index)</span><br><span class="line">                sale_amount = sale_amount.replace(r&apos;$&apos;, &apos;&apos;)</span><br><span class="line">                sale_amount = sale_amount.replace(r&apos;,&apos;, &apos;&apos;)</span><br><span class="line">                sale_amount = float(sale_amount)</span><br><span class="line">                if sale_amount &gt; threshold:</span><br><span class="line">                    for column_index in range(worksheet.ncols):</span><br><span class="line">                        cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                        cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                        if cell_type == 3:</span><br><span class="line">                            date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                            date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                            row_list.append(date_cell)</span><br><span class="line">                        else:</span><br><span class="line">                            row_list.append(cell_value)</span><br><span class="line">                if row_list:</span><br><span class="line">                    data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;第13行创建的列表变量<code>my_sheets</code>包含了两个整数，分别对应要处理的工作表（即第一个和第二个工作表）的索引值。第19行代码创建了工作簿中所有工作表的索引值，第20行代码在<code>for</code>循环中应用<code>if</code>判断语句检验要处理的工作表索引值是否在列表<code>my_sheets</code>中，这样可以确保代码只处理了我们想处理的工作表。  </p>
<blockquote>
<p>作者注：代码的第29-31行是我自己加上的，参考书（《Python数据分析基础》，作者Clinton W. Brownley，译者陈光欣，人民邮电出版社）上的代码并没有这三行，运行的时候会报错：<br>Traceback (most recent call last):<br>  File “E:\python_pycharm\Python数据分析基础\第3章 Excel文件\11excel_value_meets_condition_set_of_worksheets.py”, line 29, in <module><br>    if sale_amount &gt; threshold:<br>TypeError: ‘&gt;’ not supported between instances of ‘str’ and ‘float’<br>改正后可以正常运行。这应该是书本的错误。  </p>
</blockquote>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。  </p>
<p><img src="https://img-blog.csdnimg.cn/20200209204544276.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;使用pandas模块在工作簿中选择几个工作表非常容易，我们只需要在<code>read_excel()</code>函数中将工作表的索引值或名称设置成一个列表就可以了。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">my_sheets = [0, 1]</span><br><span class="line">threshold = 1900.0</span><br><span class="line">data_frame = pd.read_excel(input_file, sheet_name=my_sheets, index_col=None)</span><br><span class="line">row_list = []</span><br><span class="line">for worksheet_name, data in data_frame.items():</span><br><span class="line">    data[&apos;Sale Amount&apos;] = data[&apos;Sale Amount&apos;].str.replace(r&apos;\$&apos;, &apos;&apos;)</span><br><span class="line">    data[&apos;Sale Amount&apos;] = data[&apos;Sale Amount&apos;].str.replace(&apos;,&apos;, &apos;&apos;)</span><br><span class="line">    row_list.append(data[data[&apos;Sale Amount&apos;].astype(float) &gt; threshold])</span><br><span class="line">filtered_rows = pd.concat(row_list, axis=0, ignore_index=True)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">filtered_rows.to_excel(writer, sheet_name=&apos;set_of_worksheets&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200209212418387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/07/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(4)/">
                Python数据分析基础之Excel文件(4)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-07</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>&emsp;&emsp;之前的3篇博客主要讲了如何处理单个工作表。但是，很多情况下我们需要处理多个工作表，如果手工处理的话，效率会非常低，甚至根本不可行。在这种情况下，Python可以让我们自动化和规模化地进行数据处理，远远超过手工处理能够达到的限度。  </p>
<h2 id="在所有工作表中筛选特定行"><a href="#在所有工作表中筛选特定行" class="headerlink" title="在所有工作表中筛选特定行"></a>在所有工作表中筛选特定行</h2><h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;对于<a href="https://blog.csdn.net/qq_45554010/article/details/104102682" target="_blank" rel="noopener">《Python数据分析基础之Excel文件(1)》</a>中建立的sales_2013.xlsx这个Excel工作簿，我们想在所有工作表中筛选出销售额大于$2,000.00的所有行。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;filtered_rows_all_worksheets&apos;)</span><br><span class="line">sales_column_index = 3</span><br><span class="line">threshold = 2000.0</span><br><span class="line">first_worksheet = True</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    data = []</span><br><span class="line">    for worksheet in workbook.sheets():</span><br><span class="line">        if first_worksheet:</span><br><span class="line">            header_row = worksheet.row_values(0)</span><br><span class="line">            data.append(header_row)</span><br><span class="line">            first_worksheet = False</span><br><span class="line">        for row_index in range(1, worksheet.nrows):</span><br><span class="line">            row_list = []</span><br><span class="line">            sale_amount = worksheet.cell_value(row_index, sales_column_index)</span><br><span class="line">            sale_amount = sale_amount.replace(r&apos;$&apos;, &apos;&apos;)</span><br><span class="line">            sale_amount = sale_amount.replace(r&apos;,&apos;, &apos;&apos;)</span><br><span class="line">            sale_amount = float(sale_amount)</span><br><span class="line">            if sale_amount &gt; threshold:</span><br><span class="line">                for column_index in range(worksheet.ncols):</span><br><span class="line">                    cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                    cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                    if cell_type == 3:</span><br><span class="line">                        date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                        date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                        row_list.append(date_cell)</span><br><span class="line">                    else:</span><br><span class="line">                        row_list.append(cell_value)</span><br><span class="line">            if row_list:</span><br><span class="line">                data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在上面的代码中，变量<code>sales_column_index</code>保存Sale Amount列的索引值，变量<code>threshold</code>保存我们关心的销售额。我们要做的是将Sale Amount列中的每个值与这个阈值进行比较，以此来确定哪一行要被写入输出文件中。变量<code>first_worksheet</code>则是一个旗帜，其作用是用来判断当前工作表是否为第一个工作表。初始化旗帜时，我们将其设为<code>True</code>。<br>&emsp;&emsp;第19行代码通过旗帜来判断当前工作表是否为第一个工作表，如果是第一个工作表，我们就将标题行提取出来，追加到列表<code>data</code>中，然后令<code>first_worksheet = False</code>，继续处理余下的行。<br>&emsp;&emsp;在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200207211607150.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;在pandas模块中，通过在<code>read_excel()</code>函数中设置<code>sheet_name=None</code>，可以一次性读取工作簿中的所有工作表。pandas将这些工作表读入一个数据框字典，字典中的键就是工作表的名称，值就是包含工作表中数据的数据框。通过在字典的键和值之间迭代，就可以使用工作簿中所有的数据。<br>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, sheet_name=None, index_col=None)</span><br><span class="line">row_output = []</span><br><span class="line">for worksheet_name, data in data_frame.items():</span><br><span class="line">    data[&apos;Sale Amount&apos;] = data[&apos;Sale Amount&apos;].str.replace(r&apos;\$&apos;, &apos;&apos;)</span><br><span class="line">    data[&apos;Sale Amount&apos;] = data[&apos;Sale Amount&apos;].str.replace(r&apos;,&apos;, &apos;&apos;)</span><br><span class="line">    data[&apos;Sale Amount&apos;] = data[&apos;Sale Amount&apos;].astype(float)</span><br><span class="line">    row_output.append(data[data[&apos;Sale Amount&apos;].astype(float) &gt; 2000.0])</span><br><span class="line">filtered_rows = pd.concat(row_output, axis=0, ignore_index=True)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">filtered_rows.to_excel(writer, sheet_name=&apos;sale_amount_gt2000&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200207214214557.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="在所有工作表中选取特定列"><a href="#在所有工作表中选取特定列" class="headerlink" title="在所有工作表中选取特定列"></a>在所有工作表中选取特定列</h2><h4 id="1-基础Python-1"><a href="#1-基础Python-1" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;对于<a href="https://blog.csdn.net/qq_45554010/article/details/104102682" target="_blank" rel="noopener">《Python数据分析基础之Excel文件(1)》</a>中建立的sales_2013.xlsx这个Excel工作簿，我们想在所有工作表中选取Customer Name和Sale Amount列。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;selected_columns_all_worksheets&apos;)</span><br><span class="line">my_columns = [&apos;Customer Name&apos;, &apos;Sale Amount&apos;]</span><br><span class="line">first_worksheet = True</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    data = [my_columns]</span><br><span class="line">    index_of_cols_to_keep = []</span><br><span class="line">    for worksheet in workbook.sheets():</span><br><span class="line">        if first_worksheet:</span><br><span class="line">            header = worksheet.row_values(0)</span><br><span class="line">            for column_index in range(len(header)):</span><br><span class="line">                if header[column_index] in my_columns:</span><br><span class="line">                    index_of_cols_to_keep.append(column_index)</span><br><span class="line">            first_worksheet = False</span><br><span class="line">        for row_index in range(1, worksheet.nrows):</span><br><span class="line">            row_list = []</span><br><span class="line">            for column_index in index_of_cols_to_keep:</span><br><span class="line">                cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                if cell_type == 3:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">            data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;列表变量<code>my_columns</code>包含了我们要保留的两列的名称。将<code>my_columns</code>放入<code>data</code>，作为<code>data</code>中的第一个列表，因为它是要写入输出文件的列的标题。列表变量<code>index_of_cols_to_keep</code>用来保存Customer Name和Sale Amount列的索引值。<br>&emsp;&emsp;在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/2020020721552615.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas-1"><a href="#2-pandas-1" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;使用pandas模块的思路和上面筛选特定列的思路类似，代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, sheet_name=None, index_col=None)</span><br><span class="line">column_output = []</span><br><span class="line">for worksheet_name, data in data_frame.items():</span><br><span class="line">    column_output.append(data.loc[:, [&apos;Customer Name&apos;, &apos;Sale Amount&apos;]])</span><br><span class="line">selected_columns = pd.concat(column_output, axis=0, ignore_index=True)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">selected_columns.to_excel(writer, sheet_name=&apos;selected_columns_all_worksheets&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200207220701568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/07/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(3)/">
                Python数据分析基础之Excel文件(3)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-07</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="选取特定列"><a href="#选取特定列" class="headerlink" title="选取特定列"></a>选取特定列</h2><p>&emsp;&emsp;有些时候，我们并不需要工作表中所有的列。我们可以用Python选取出需要保留的列。<br>&emsp;&emsp;有两种方法可以在Excel文件中选取特定的列：<br>&emsp;&emsp;1.使用列索引值；<br>&emsp;&emsp;2.使用列标题。</p>
<h4 id="1-1-使用列索引值（基础Python）"><a href="#1-1-使用列索引值（基础Python）" class="headerlink" title="1.1 使用列索引值（基础Python）"></a>1.1 使用列索引值（基础Python）</h4><p>&emsp;&emsp;这里我们以保留之前的<code>january_2013</code>工作表中Customer Name和Purchase Date这两列为例。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">my_columns = [1, 4]</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = []</span><br><span class="line">    for row_index in range(worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        for column_index in my_columns:</span><br><span class="line">            cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">            cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">            if cell_type == 3:</span><br><span class="line">                date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                row_list.append(date_cell)</span><br><span class="line">            else:</span><br><span class="line">                row_list.append(cell_value)</span><br><span class="line">        data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上面的代码中，列表变量<code>my_columns</code>包含整数1和4，分别代表了Customer Name和Purchase Date这两列的索引值。其他代码与之前练习过的代码类似，在这里不再赘述。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/2020020717392726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-2-使用列索引值（pandas）"><a href="#1-2-使用列索引值（pandas）" class="headerlink" title="1.2 使用列索引值（pandas）"></a>1.2 使用列索引值（pandas）</h4><p>&emsp;&emsp;使用pandas模块根据列索引值选取特定列，我们需要设置数据框以及用到<code>iloc</code>函数。这里需要提到一点，<code>iloc</code>函数可以使我们同时选择特定的行和特定的列，<strong>所以如果我们想使用它选取特定的列，那么就需要在列索引值前面加上一个冒号和一个逗号，表示为这些特定的列保留所有的行，否则函数就会使用这些索引值去筛选行。</strong><br>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">data_frame_column_by_index = data_frame.iloc[:, [1, 4]]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_column_by_index.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200207174907995.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-1-使用列标题（基础Python）"><a href="#2-1-使用列标题（基础Python）" class="headerlink" title="2.1 使用列标题（基础Python）"></a>2.1 使用列标题（基础Python）</h4><p>&emsp;&emsp;这种方法适用于<strong>想保留的列的标题非常容易识别，或者在处理多个输入文件的过程中，各个输入文件中列的位置会发生改变但标题不变</strong>的情况。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">my_columns = [&apos;Customer ID&apos;, &apos;Purchase Date&apos;]</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = [my_columns]</span><br><span class="line">    header_list = worksheet.row_values(0)</span><br><span class="line">    header_index_list = []</span><br><span class="line">    for header_index in range(len(header_list)):</span><br><span class="line">        if header_list[header_index] in my_columns:</span><br><span class="line">            header_index_list.append(header_index)</span><br><span class="line">    for row_index in range(1, worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        for column_index in header_index_list:</span><br><span class="line">            cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">            cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">            if cell_type == 3:</span><br><span class="line">                date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                row_list.append(date_cell)</span><br><span class="line">            else:</span><br><span class="line">                row_list.append(cell_value)</span><br><span class="line">        data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上面的代码中，列表变量<code>my_columns</code>包含了要保留的两列的名称。因为这是要写入文件的列表题，所以直接将其加入到输出列表<code>data</code>中。其他代码与之前练习过的代码类似，在这里不再赘述。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200207180402531.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-2-使用列标题（pandas）"><a href="#2-2-使用列标题（pandas）" class="headerlink" title="2.2 使用列标题（pandas）"></a>2.2 使用列标题（pandas）</h4><p>&emsp;&emsp;使用pandas模块根据列标题选取特定列，我们需要使用<code>loc</code>函数。和前面提到的<code>iloc</code>函数类似，<strong>如果我们想使用它选取特定的列，那么就需要在列索引值前面加上一个冒号和一个逗号，表示为这些特定的列保留所有的行，否则函数就会使用这些索引值去筛选行。</strong><br>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">data_frame_column_by_name = data_frame.loc[:, [&apos;Customer ID&apos;, &apos;Purchase Date&apos;]]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_column_by_name.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200207181404695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/03/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(2)/">
                Python数据分析基础之Excel文件(2)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-03</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="处理单个工作表——读写Excel文件"><a href="#处理单个工作表——读写Excel文件" class="headerlink" title="处理单个工作表——读写Excel文件"></a>处理单个工作表——读写Excel文件</h2><h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;要使用基础Python读写Excel文件，我们需要导入xlrd和xlwt模块。<br>&emsp;&emsp;对于上一节创建的Excel工作簿，我们试着来读取其中的<code>january_2013</code>工作表中的数据。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from xlrd import open_workbook</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    for row_index in range(worksheet.nrows):</span><br><span class="line">        for column_index in range(worksheet.ncols):</span><br><span class="line">            output_worksheet.write(row_index, column_index, worksheet.cell_value(row_index, column_index))</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from xlrd import open_workbook</span><br><span class="line">from xlwt import Workbook</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这两行代码导入了xlrd模块的<code>open_workbook()</code>函数以及xlwt模块的<code>Workbook</code>对象。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里实例化<code>Workbook</code>对象，以使我们可以将结果写入用于输出的Excel文件。接下来一行，<code>add_sheet()</code>函数为输出工作簿添加了一个名为<code>jan_2013_output</code>的工作表。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用<code>workbook</code>对象的<code>sheet_by_name()</code>函数引用名称为<code>january_2013</code>的工作表。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200202153219118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, sheet_name=&apos;january_2013&apos;)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行脚本后得到的输出文件如下：<br><img src="https://img-blog.csdnimg.cn/20200202155258262.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="处理单个工作表——筛选特定行"><a href="#处理单个工作表——筛选特定行" class="headerlink" title="处理单个工作表——筛选特定行"></a>处理单个工作表——筛选特定行</h2><p>&emsp;&emsp;和之前学习CSV文件一样，有的时候我们不需要Excel文件中的所有行，在这种情况下，我们可以使用Python来对工作表中的行进行筛选。  </p>
<h4 id="1-1-行中的值满足某个条件（基础Python）"><a href="#1-1-行中的值满足某个条件（基础Python）" class="headerlink" title="1.1 行中的值满足某个条件（基础Python）"></a>1.1 行中的值满足某个条件（基础Python）</h4><p>&emsp;&emsp;比如说，我们想对之前的工作表中的行进行筛选，保留Sale Amount大于$1,400.00的行。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">sale_amount_column_index = 3</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = []</span><br><span class="line">    header = worksheet.row_values(0)</span><br><span class="line">    data.append(header)</span><br><span class="line">    for row_index in range(1, worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        sale_amount = worksheet.cell_value(row_index, sale_amount_column_index)</span><br><span class="line">        sale = worksheet.cell_value(row_index, sale_amount_column_index)</span><br><span class="line">        sale_amount = float(str(sale).strip(&apos;$&apos;).replace(&apos;,&apos;, &apos;&apos;))</span><br><span class="line">        if sale_amount &gt; 1400.0:</span><br><span class="line">            for column_index in range(worksheet.ncols):</span><br><span class="line">                cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                if cell_type == 3:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">        if row_list:</span><br><span class="line">            data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们导入了datetime模块的<code>date()</code>函数，以使我们可以将数值转换成日期并对日期进行格式化。xlrd模块中的<code>xldate_as_tuple()</code>函数可以将Excel中代表日期、时间或日期时间的数值转换为元组。将数值转换成元组可以提取出具体时间元素，并将时间元素格式化成不同的时间格式。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = []</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码创建了一个空列表<code>data</code>，我们将用要写入输出文件的行来填充它。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sale_amount = worksheet.cell_value(row_index, sale_amount_column_index)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;变量<code>sale_amount</code>用来保存行中的销售额，作为检验销售额是否大于$1,400.00的条件。<code>cell_value()</code>函数使用<code>sale_amount_column_index</code>的值来定位Sale Amount列。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">for column_index in range(worksheet.ncols):</span><br><span class="line">    cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">    cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">    if cell_type == 3:</span><br><span class="line">        date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">        date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">        row_list.append(date_cell)</span><br><span class="line">    else:</span><br><span class="line">        row_list.append(cell_value)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里创建了一个<code>for</code>循环，来处理Sale Amount大于$1,400.00的那些行。我们先用<code>cell_value()</code>函数来提取出每个单元格的值，赋给变量<code>cell_value</code>，再用<code>cell_type()</code>函数提取出每个单元格的类型，赋给变量<code>cell_type</code>。然后，检验行中的每个值是否为日期类型（即检验<code>cell_type</code>是否等于3），如果是，就将这个值格式化成日期数据，追加进前面创建的空列表<code>row_list</code>中。如果<code>cell_type</code>不是3，则说明其为非日期类型数据，直接追加进列表<code>row_list</code>即可。  </p>
<blockquote>
<p>xlrd模块的说明文档（<a href="https://secure.simplistix.co.uk/svn/xlrd/trunk/xlrd/doc/xlrd.html?p=4966#sheet.Cell-class）中写到，单元格类型为3表示这个单元格中包含日期数据。" target="_blank" rel="noopener">https://secure.simplistix.co.uk/svn/xlrd/trunk/xlrd/doc/xlrd.html?p=4966#sheet.Cell-class）中写到，单元格类型为3表示这个单元格中包含日期数据。</a>  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if row_list:</span><br><span class="line">    data.append(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们为输入文件的每一行都创建空列表<code>row_list</code>，但是只使用值填充某些空列表。对于输入文件的每一行，这里的<code>if</code>语句判断<code>row_list</code>是否为空，如果非空，则将其添加到<code>data</code>中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for list_index, output_list in enumerate(data):</span><br><span class="line">    for element_index, element in enumerate(output_list):</span><br><span class="line">        output_worksheet.write(list_index, element_index, element)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们在<code>data</code>中的各个列表之间和列表中的各个值之间进行迭代，将这些值写入输出文件。<br>&emsp;&emsp;将要保留的行追加到<code>data</code>中的原因是，这样可以得到新的连续的行索引值。于是，当我们将这些行写入输出文件时，它们看上去就像是一个连续的整体，行与行之间不会出现缺口。否则，如果在主体<code>for</code>循环中处理各行的时候就将它们写入输出文件的话，那么xlwt的<code>write()</code>函数就会使用输入文件中原来的行索引值将行写入输出文件，造成行与行之间的缺口。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200202215848893.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-2-行中的值满足某个条件（pandas）"><a href="#1-2-行中的值满足某个条件（pandas）" class="headerlink" title="1.2 行中的值满足某个条件（pandas）"></a>1.2 行中的值满足某个条件（pandas）</h4><p>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">data_frame_value_meets_condition = data_frame[&apos;Sale Amount&apos;] = data_frame[&apos;Sale Amount&apos;].str.replace(r&apos;\$&apos;, &apos;&apos;)</span><br><span class="line">data_frame[&apos;Sale Amount&apos;] = data_frame[&apos;Sale Amount&apos;].str.replace(&apos;,&apos;, &apos;&apos;)</span><br><span class="line">data_frame[&apos;Sale Amount&apos;] = data_frame[&apos;Sale Amount&apos;].astype(float)</span><br><span class="line">data_frame_value_meets_condition = data_frame[data_frame[&apos;Sale Amount&apos;].astype(float) &gt; 1400.0]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_value_meets_condition.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行脚本，得到的输出文件如下：<br><img src="https://img-blog.csdnimg.cn/20200203112451896.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-1-行中的值属于某个集合（基础Python）"><a href="#2-1-行中的值属于某个集合（基础Python）" class="headerlink" title="2.1 行中的值属于某个集合（基础Python）"></a>2.1 行中的值属于某个集合（基础Python）</h4><p>&emsp;&emsp;接下来，我们来筛选出<code>january_2013</code>工作表中购买日期属于<code>1/24/2013</code>和<code>1/31/2013</code>的行。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">important_dates = [&apos;01/24/2013&apos;, &apos;01/31/2013&apos;]</span><br><span class="line">purchase_date_column_index = 4</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = []</span><br><span class="line">    header = worksheet.row_values(0)</span><br><span class="line">    data.append(header)</span><br><span class="line">    for row_index in range(1, worksheet.nrows):</span><br><span class="line">        purchase_datetime = xldate_as_tuple(worksheet.cell_value(row_index, purchase_date_column_index),</span><br><span class="line">                                            workbook.datemode)</span><br><span class="line">        purchase_date = date(*purchase_datetime[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">        row_list = []</span><br><span class="line">        if purchase_date in important_dates:</span><br><span class="line">            for column_index in range(worksheet.ncols):</span><br><span class="line">                cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                if cell_type == 3:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">        if row_list:</span><br><span class="line">            data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在跟着书上的代码学习时，书上的代码有一些印刷错误，这让我踩了不少的坑。上面的代码是在PyCharm 2019.3.2(Professional Edition) + Anaconda环境下成功运行的。感谢实验室的学长的指导。  </p>
</blockquote>
<p>&emsp;&emsp;这个脚本与基于条件筛选行的脚本非常相似，这里只对有差别的部分做一下简单的解释。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">important_dates = [&apos;01/24/2013&apos;, &apos;01/31/2013&apos;]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码创建了列表<code>important_dates</code>，里面包含了要使用的日期。<strong>这里需要注意的一点是，日期不能写成类似于’1/24/2013’的格式，否则会出问题！</strong><br>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件如下：<br><img src="https://img-blog.csdnimg.cn/20200203193534268.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-2-行中的值属于某个集合（pandas）"><a href="#2-2-行中的值属于某个集合（pandas）" class="headerlink" title="2.2 行中的值属于某个集合（pandas）"></a>2.2 行中的值属于某个集合（pandas）</h4><p>&emsp;&emsp;如果使用pandas模块的话，我们想筛选出特定的日期，需要用到函数<code>isin()</code>。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">important_dates = [&apos;01/24/2013&apos;, &apos;01/31/2013&apos;]</span><br><span class="line">data_frame_value_in_set = data_frame[data_frame[&apos;Purchase Date&apos;].isin(important_dates)]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_value_in_set.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200203194720822.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3-1-行中的值匹配于特定模式（基础Python）"><a href="#3-1-行中的值匹配于特定模式（基础Python）" class="headerlink" title="3.1 行中的值匹配于特定模式（基础Python）"></a>3.1 行中的值匹配于特定模式（基础Python）</h4><p>&emsp;&emsp;要想使行中的值匹配于特定模式，我们需要引入正则表达式。下面的代码将会筛选出表格中客户姓名以大写字母’J’开头的行。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">pattern = re.compile(r&apos;(?P&lt;my_pattern&gt;^J.*)&apos;)</span><br><span class="line">customer_name_column_index = 1</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = []</span><br><span class="line">    header = worksheet.row_values(0)</span><br><span class="line">    data.append(header)</span><br><span class="line">    for row_index in range(1, worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        if pattern.search(worksheet.cell_value(row_index, customer_name_column_index)):</span><br><span class="line">            for column_index in range(worksheet.ncols):</span><br><span class="line">                cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                if cell_type == 3:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">        if row_list:</span><br><span class="line">            data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们只对正则表达式的部分做一个说明。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pattern = re.compile(r&apos;(?P&lt;my_pattern&gt;^J.*)&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用re模块的<code>compile()</code>函数创建了一个正则表达式<code>pattern</code>。其中，<code>r</code>表示单引号之间的模式是一个原始字符串。元字符<code>?P&lt;my_pattern&gt;</code>捕获了名为<code>&lt;my_pattern&gt;</code>的组中匹配了的子字符串。我们要搜索的实际模式是<code>^J.*</code>。插入符号<code>^</code>表示在字符串开头搜索模式，句点<code>.</code>可以匹配任何除了换行符<code>\n</code>的字符，星号<code>*</code>则表示重复前面的字符0次或更多次。<code>.*</code>组合在一起使用表示除换行符<code>\n</code>之外的任意字符可以在J后面出现任意次。<br>&emsp;&emsp;有关正则表达式的内容，可以参考我之前写的博客：<a href="https://blog.csdn.net/qq_45554010/article/details/104022260" target="_blank" rel="noopener">Python与正则表达式</a>。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/2020020320050554.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3-2-行中的值匹配于特定模式（pandas）"><a href="#3-2-行中的值匹配于特定模式（pandas）" class="headerlink" title="3.2 行中的值匹配于特定模式（pandas）"></a>3.2 行中的值匹配于特定模式（pandas）</h4><p>&emsp;&emsp;pandas模块提供了若干字符串和正则表达式函数，如<code>startswith()</code>, <code>endswith()</code>, <code>match()</code>和<code>search()</code>等。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">data_frame_value_matcher_pattern = data_frame[data_frame[&apos;Customer Name&apos;].str.startswith(&quot;J&quot;)]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_value_matcher_pattern.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行脚本，得到输出文件如下：<br><img src="https://img-blog.csdnimg.cn/20200203201859574.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/01/28/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(1)/">
                Python数据分析基础之Excel文件(1)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-01-28</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <blockquote>
<p>参考资料：<br>《Python数据分析基础》，作者[美]Clinton W. Brownley，译者陈光欣，中国工信出版集团，人民邮电出版社</p>
</blockquote>
<h2 id="Excel文件简述"><a href="#Excel文件简述" class="headerlink" title="Excel文件简述"></a>Excel文件简述</h2><p>&emsp;&emsp;Microsoft Excel是Microsoft为使用Windows和Apple Macintosh操作系统的电脑编写的一款电子表格软件，它几乎无处不在，是商业活动中不可或缺的工具。使用Python可以处理Excel文件中的数据。<br>&emsp;&emsp;与Python的csv模块不同，Python中没有处理Excel文件的标准模块。我们需要安装xlrd和xlwt两个模块。  </p>
<h2 id="内省Excel工作簿"><a href="#内省Excel工作簿" class="headerlink" title="内省Excel工作簿"></a>内省Excel工作簿</h2><p>&emsp;&emsp;我们创建一个Excel工作簿，并在其中添加3个独立的工作表，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200128212600770.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200128212621474.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200128212629366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">&emsp;&emsp;Excel文件与CSV文件至少在两个重要方面有所不同。首先，CSV文件是纯文本文件，而Excel文件不是纯文本文件，我们不能在文本编辑器中打开它并查看数据。其次，与CSV文件不同，一个Excel工作簿被设计成包含多个工作表。<br>&emsp;&emsp;通过内省一个工作簿，我们可以在实际开始处理工作簿中的数据之前，检查工作表的数目和每个工作表中的数据类型和数据量。<br>&emsp;&emsp;下面我们使用Python分析上面的工作簿，来确定工作簿中工作表的数量、名称和每个工作表中行列的数量。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from xlrd import open_workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line"></span><br><span class="line">workbook = open_workbook(input_file)</span><br><span class="line">print(&apos;Number of worksheets: &apos;, workbook.nsheets)</span><br><span class="line">for worksheet in workbook.sheets():</span><br><span class="line">    print(&quot;Worksheet name: &quot;, worksheet.name, &quot;\tRows: &quot;, worksheet.nrows, &quot;\tColumns: &quot;, worksheet.ncols)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from xlrd import open_workbook</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码导入xlrd模块的<code>open_workbook()</code>函数来读取和分析Excel文件。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">workbook = open_workbook(input_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用<code>open_workbook()</code>函数打开一个Excel输入文件，并赋给对象<code>workbook</code>。可以使用这个对象从工作簿中得到单独的工作表。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for worksheet in workbook.sheets():</span><br><span class="line">    print(&quot;Worksheet name: &quot;, worksheet.name, &quot;\tRows: &quot;, worksheet.nrows, &quot;\tColumns: &quot;, worksheet.ncols)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>for</code>循环语句在工作簿中的所有工作表之间迭代。<code>workbook</code>对象的<code>sheets()</code>方法可以识别出工作簿中所有的工作表。<code>print</code>语句使用<code>workbook</code>对象的<code>name</code>, <code>nrows</code>, <code>ncols</code>属性来确定每个工作表的名称以及行与列的数量。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，得到下面的输出结果。<br><img src="https://img-blog.csdnimg.cn/2020012821403180.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="" href="/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/3/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    I'd walk a million miles just to see your smile. 
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2020/03/16/%E5%AE%9E%E9%AA%8C%E5%AE%A420200314%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%BB%BB%E5%8A%A1%E6%80%BB%E7%BB%93/">实验室20200314数据处理任务总结</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2020/03/01/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8C%89%E8%AE%A1%E5%88%92%E8%87%AA%E5%8A%A8%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC%EF%BC%88Windows%E7%B3%BB%E7%BB%9F%EF%BC%89/">Python数据分析基础之按计划自动运行脚本（Wi</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2020/02/28/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1%E4%B8%8E%E5%BB%BA%E6%A8%A1(1)/">Python数据分析基础之描述性统计与建模(1)</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2020/02/20/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%9B%BE%E4%B8%8E%E5%9B%BE%E8%A1%A8%EF%BC%88ggplot%E7%95%AA%E5%A4%96%E7%AF%87%EF%BC%89/">Python数据分析基础之图与图表（ggplot番</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/CCH21" target="_blank" rel="noopener">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:1398635912@qq.com" target="_blank" rel="noopener">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/" target="_blank" rel="noopener">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>