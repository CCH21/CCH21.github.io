<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="John Doe">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Welcome to CCH21&#39;s Blog"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Welcome to CCH21&#39;s Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Welcome to CCH21&#39;s Blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">Welcome to CCH21's Blog</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/07/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(4)/">
                Python数据分析基础之Excel文件(4)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-07</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>&emsp;&emsp;之前的3篇博客主要讲了如何处理单个工作表。但是，很多情况下我们需要处理多个工作表，如果手工处理的话，效率会非常低，甚至根本不可行。在这种情况下，Python可以让我们自动化和规模化地进行数据处理，远远超过手工处理能够达到的限度。  </p>
<h2 id="在所有工作表中筛选特定行"><a href="#在所有工作表中筛选特定行" class="headerlink" title="在所有工作表中筛选特定行"></a>在所有工作表中筛选特定行</h2><h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;对于<a href="https://blog.csdn.net/qq_45554010/article/details/104102682" target="_blank" rel="noopener">《Python数据分析基础之Excel文件(1)》</a>中建立的sales_2013.xlsx这个Excel工作簿，我们想在所有工作表中筛选出销售额大于$2,000.00的所有行。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;filtered_rows_all_worksheets&apos;)</span><br><span class="line">sales_column_index = 3</span><br><span class="line">threshold = 2000.0</span><br><span class="line">first_worksheet = True</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    data = []</span><br><span class="line">    for worksheet in workbook.sheets():</span><br><span class="line">        if first_worksheet:</span><br><span class="line">            header_row = worksheet.row_values(0)</span><br><span class="line">            data.append(header_row)</span><br><span class="line">            first_worksheet = False</span><br><span class="line">        for row_index in range(1, worksheet.nrows):</span><br><span class="line">            row_list = []</span><br><span class="line">            sale_amount = worksheet.cell_value(row_index, sales_column_index)</span><br><span class="line">            sale_amount = sale_amount.replace(r&apos;$&apos;, &apos;&apos;)</span><br><span class="line">            sale_amount = sale_amount.replace(r&apos;,&apos;, &apos;&apos;)</span><br><span class="line">            sale_amount = float(sale_amount)</span><br><span class="line">            if sale_amount &gt; threshold:</span><br><span class="line">                for column_index in range(worksheet.ncols):</span><br><span class="line">                    cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                    cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                    if cell_type == 3:</span><br><span class="line">                        date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                        date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                        row_list.append(date_cell)</span><br><span class="line">                    else:</span><br><span class="line">                        row_list.append(cell_value)</span><br><span class="line">            if row_list:</span><br><span class="line">                data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在上面的代码中，变量<code>sales_column_index</code>保存Sale Amount列的索引值，变量<code>threshold</code>保存我们关心的销售额。我们要做的是将Sale Amount列中的每个值与这个阈值进行比较，以此来确定哪一行要被写入输出文件中。变量<code>first_worksheet</code>则是一个旗帜，其作用是用来判断当前工作表是否为第一个工作表。初始化旗帜时，我们将其设为<code>True</code>。<br>&emsp;&emsp;第19行代码通过旗帜来判断当前工作表是否为第一个工作表，如果是第一个工作表，我们就将标题行提取出来，追加到列表<code>data</code>中，然后令<code>first_worksheet = False</code>，继续处理余下的行。<br>&emsp;&emsp;在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200207211607150.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;在pandas模块中，通过在<code>read_excel()</code>函数中设置<code>sheet_name=None</code>，可以一次性读取工作簿中的所有工作表。pandas将这些工作表读入一个数据框字典，字典中的键就是工作表的名称，值就是包含工作表中数据的数据框。通过在字典的键和值之间迭代，就可以使用工作簿中所有的数据。<br>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, sheet_name=None, index_col=None)</span><br><span class="line">row_output = []</span><br><span class="line">for worksheet_name, data in data_frame.items():</span><br><span class="line">    data[&apos;Sale Amount&apos;] = data[&apos;Sale Amount&apos;].str.replace(r&apos;\$&apos;, &apos;&apos;)</span><br><span class="line">    data[&apos;Sale Amount&apos;] = data[&apos;Sale Amount&apos;].str.replace(r&apos;,&apos;, &apos;&apos;)</span><br><span class="line">    data[&apos;Sale Amount&apos;] = data[&apos;Sale Amount&apos;].astype(float)</span><br><span class="line">    row_output.append(data[data[&apos;Sale Amount&apos;].astype(float) &gt; 2000.0])</span><br><span class="line">filtered_rows = pd.concat(row_output, axis=0, ignore_index=True)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">filtered_rows.to_excel(writer, sheet_name=&apos;sale_amount_gt2000&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200207214214557.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="在所有工作表中选取特定列"><a href="#在所有工作表中选取特定列" class="headerlink" title="在所有工作表中选取特定列"></a>在所有工作表中选取特定列</h2><h4 id="1-基础Python-1"><a href="#1-基础Python-1" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;对于<a href="https://blog.csdn.net/qq_45554010/article/details/104102682" target="_blank" rel="noopener">《Python数据分析基础之Excel文件(1)》</a>中建立的sales_2013.xlsx这个Excel工作簿，我们想在所有工作表中选取Customer Name和Sale Amount列。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;selected_columns_all_worksheets&apos;)</span><br><span class="line">my_columns = [&apos;Customer Name&apos;, &apos;Sale Amount&apos;]</span><br><span class="line">first_worksheet = True</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    data = [my_columns]</span><br><span class="line">    index_of_cols_to_keep = []</span><br><span class="line">    for worksheet in workbook.sheets():</span><br><span class="line">        if first_worksheet:</span><br><span class="line">            header = worksheet.row_values(0)</span><br><span class="line">            for column_index in range(len(header)):</span><br><span class="line">                if header[column_index] in my_columns:</span><br><span class="line">                    index_of_cols_to_keep.append(column_index)</span><br><span class="line">            first_worksheet = False</span><br><span class="line">        for row_index in range(1, worksheet.nrows):</span><br><span class="line">            row_list = []</span><br><span class="line">            for column_index in index_of_cols_to_keep:</span><br><span class="line">                cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                if cell_type == 3:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">            data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;列表变量<code>my_columns</code>包含了我们要保留的两列的名称。将<code>my_columns</code>放入<code>data</code>，作为<code>data</code>中的第一个列表，因为它是要写入输出文件的列的标题。列表变量<code>index_of_cols_to_keep</code>用来保存Customer Name和Sale Amount列的索引值。<br>&emsp;&emsp;在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/2020020721552615.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas-1"><a href="#2-pandas-1" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;使用pandas模块的思路和上面筛选特定列的思路类似，代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, sheet_name=None, index_col=None)</span><br><span class="line">column_output = []</span><br><span class="line">for worksheet_name, data in data_frame.items():</span><br><span class="line">    column_output.append(data.loc[:, [&apos;Customer Name&apos;, &apos;Sale Amount&apos;]])</span><br><span class="line">selected_columns = pd.concat(column_output, axis=0, ignore_index=True)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">selected_columns.to_excel(writer, sheet_name=&apos;selected_columns_all_worksheets&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200207220701568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/07/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(3)/">
                Python数据分析基础之Excel文件(3)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-07</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="选取特定列"><a href="#选取特定列" class="headerlink" title="选取特定列"></a>选取特定列</h2><p>&emsp;&emsp;有些时候，我们并不需要工作表中所有的列。我们可以用Python选取出需要保留的列。<br>&emsp;&emsp;有两种方法可以在Excel文件中选取特定的列：<br>&emsp;&emsp;1.使用列索引值；<br>&emsp;&emsp;2.使用列标题。</p>
<h4 id="1-1-使用列索引值（基础Python）"><a href="#1-1-使用列索引值（基础Python）" class="headerlink" title="1.1 使用列索引值（基础Python）"></a>1.1 使用列索引值（基础Python）</h4><p>&emsp;&emsp;这里我们以保留之前的<code>january_2013</code>工作表中Customer Name和Purchase Date这两列为例。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">my_columns = [1, 4]</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = []</span><br><span class="line">    for row_index in range(worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        for column_index in my_columns:</span><br><span class="line">            cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">            cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">            if cell_type == 3:</span><br><span class="line">                date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                row_list.append(date_cell)</span><br><span class="line">            else:</span><br><span class="line">                row_list.append(cell_value)</span><br><span class="line">        data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上面的代码中，列表变量<code>my_columns</code>包含整数1和4，分别代表了Customer Name和Purchase Date这两列的索引值。其他代码与之前练习过的代码类似，在这里不再赘述。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/2020020717392726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-2-使用列索引值（pandas）"><a href="#1-2-使用列索引值（pandas）" class="headerlink" title="1.2 使用列索引值（pandas）"></a>1.2 使用列索引值（pandas）</h4><p>&emsp;&emsp;使用pandas模块根据列索引值选取特定列，我们需要设置数据框以及用到<code>iloc</code>函数。这里需要提到一点，<code>iloc</code>函数可以使我们同时选择特定的行和特定的列，<strong>所以如果我们想使用它选取特定的列，那么就需要在列索引值前面加上一个冒号和一个逗号，表示为这些特定的列保留所有的行，否则函数就会使用这些索引值去筛选行。</strong><br>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">data_frame_column_by_index = data_frame.iloc[:, [1, 4]]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_column_by_index.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200207174907995.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-1-使用列标题（基础Python）"><a href="#2-1-使用列标题（基础Python）" class="headerlink" title="2.1 使用列标题（基础Python）"></a>2.1 使用列标题（基础Python）</h4><p>&emsp;&emsp;这种方法适用于<strong>想保留的列的标题非常容易识别，或者在处理多个输入文件的过程中，各个输入文件中列的位置会发生改变但标题不变</strong>的情况。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">my_columns = [&apos;Customer ID&apos;, &apos;Purchase Date&apos;]</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = [my_columns]</span><br><span class="line">    header_list = worksheet.row_values(0)</span><br><span class="line">    header_index_list = []</span><br><span class="line">    for header_index in range(len(header_list)):</span><br><span class="line">        if header_list[header_index] in my_columns:</span><br><span class="line">            header_index_list.append(header_index)</span><br><span class="line">    for row_index in range(1, worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        for column_index in header_index_list:</span><br><span class="line">            cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">            cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">            if cell_type == 3:</span><br><span class="line">                date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                row_list.append(date_cell)</span><br><span class="line">            else:</span><br><span class="line">                row_list.append(cell_value)</span><br><span class="line">        data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上面的代码中，列表变量<code>my_columns</code>包含了要保留的两列的名称。因为这是要写入文件的列表题，所以直接将其加入到输出列表<code>data</code>中。其他代码与之前练习过的代码类似，在这里不再赘述。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200207180402531.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-2-使用列标题（pandas）"><a href="#2-2-使用列标题（pandas）" class="headerlink" title="2.2 使用列标题（pandas）"></a>2.2 使用列标题（pandas）</h4><p>&emsp;&emsp;使用pandas模块根据列标题选取特定列，我们需要使用<code>loc</code>函数。和前面提到的<code>iloc</code>函数类似，<strong>如果我们想使用它选取特定的列，那么就需要在列索引值前面加上一个冒号和一个逗号，表示为这些特定的列保留所有的行，否则函数就会使用这些索引值去筛选行。</strong><br>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">data_frame_column_by_name = data_frame.loc[:, [&apos;Customer ID&apos;, &apos;Purchase Date&apos;]]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_column_by_name.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200207181404695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/02/03/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(2)/">
                Python数据分析基础之Excel文件(2)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-02-03</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="处理单个工作表——读写Excel文件"><a href="#处理单个工作表——读写Excel文件" class="headerlink" title="处理单个工作表——读写Excel文件"></a>处理单个工作表——读写Excel文件</h2><h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;要使用基础Python读写Excel文件，我们需要导入xlrd和xlwt模块。<br>&emsp;&emsp;对于上一节创建的Excel工作簿，我们试着来读取其中的<code>january_2013</code>工作表中的数据。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from xlrd import open_workbook</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    for row_index in range(worksheet.nrows):</span><br><span class="line">        for column_index in range(worksheet.ncols):</span><br><span class="line">            output_worksheet.write(row_index, column_index, worksheet.cell_value(row_index, column_index))</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from xlrd import open_workbook</span><br><span class="line">from xlwt import Workbook</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这两行代码导入了xlrd模块的<code>open_workbook()</code>函数以及xlwt模块的<code>Workbook</code>对象。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里实例化<code>Workbook</code>对象，以使我们可以将结果写入用于输出的Excel文件。接下来一行，<code>add_sheet()</code>函数为输出工作簿添加了一个名为<code>jan_2013_output</code>的工作表。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用<code>workbook</code>对象的<code>sheet_by_name()</code>函数引用名称为<code>january_2013</code>的工作表。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200202153219118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, sheet_name=&apos;january_2013&apos;)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行脚本后得到的输出文件如下：<br><img src="https://img-blog.csdnimg.cn/20200202155258262.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="处理单个工作表——筛选特定行"><a href="#处理单个工作表——筛选特定行" class="headerlink" title="处理单个工作表——筛选特定行"></a>处理单个工作表——筛选特定行</h2><p>&emsp;&emsp;和之前学习CSV文件一样，有的时候我们不需要Excel文件中的所有行，在这种情况下，我们可以使用Python来对工作表中的行进行筛选。  </p>
<h4 id="1-1-行中的值满足某个条件（基础Python）"><a href="#1-1-行中的值满足某个条件（基础Python）" class="headerlink" title="1.1 行中的值满足某个条件（基础Python）"></a>1.1 行中的值满足某个条件（基础Python）</h4><p>&emsp;&emsp;比如说，我们想对之前的工作表中的行进行筛选，保留Sale Amount大于$1,400.00的行。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">sale_amount_column_index = 3</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = []</span><br><span class="line">    header = worksheet.row_values(0)</span><br><span class="line">    data.append(header)</span><br><span class="line">    for row_index in range(1, worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        sale_amount = worksheet.cell_value(row_index, sale_amount_column_index)</span><br><span class="line">        sale = worksheet.cell_value(row_index, sale_amount_column_index)</span><br><span class="line">        sale_amount = float(str(sale).strip(&apos;$&apos;).replace(&apos;,&apos;, &apos;&apos;))</span><br><span class="line">        if sale_amount &gt; 1400.0:</span><br><span class="line">            for column_index in range(worksheet.ncols):</span><br><span class="line">                cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                if cell_type == 3:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">        if row_list:</span><br><span class="line">            data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们导入了datetime模块的<code>date()</code>函数，以使我们可以将数值转换成日期并对日期进行格式化。xlrd模块中的<code>xldate_as_tuple()</code>函数可以将Excel中代表日期、时间或日期时间的数值转换为元组。将数值转换成元组可以提取出具体时间元素，并将时间元素格式化成不同的时间格式。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = []</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码创建了一个空列表<code>data</code>，我们将用要写入输出文件的行来填充它。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sale_amount = worksheet.cell_value(row_index, sale_amount_column_index)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;变量<code>sale_amount</code>用来保存行中的销售额，作为检验销售额是否大于$1,400.00的条件。<code>cell_value()</code>函数使用<code>sale_amount_column_index</code>的值来定位Sale Amount列。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">for column_index in range(worksheet.ncols):</span><br><span class="line">    cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">    cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">    if cell_type == 3:</span><br><span class="line">        date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">        date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">        row_list.append(date_cell)</span><br><span class="line">    else:</span><br><span class="line">        row_list.append(cell_value)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里创建了一个<code>for</code>循环，来处理Sale Amount大于$1,400.00的那些行。我们先用<code>cell_value()</code>函数来提取出每个单元格的值，赋给变量<code>cell_value</code>，再用<code>cell_type()</code>函数提取出每个单元格的类型，赋给变量<code>cell_type</code>。然后，检验行中的每个值是否为日期类型（即检验<code>cell_type</code>是否等于3），如果是，就将这个值格式化成日期数据，追加进前面创建的空列表<code>row_list</code>中。如果<code>cell_type</code>不是3，则说明其为非日期类型数据，直接追加进列表<code>row_list</code>即可。  </p>
<blockquote>
<p>xlrd模块的说明文档（<a href="https://secure.simplistix.co.uk/svn/xlrd/trunk/xlrd/doc/xlrd.html?p=4966#sheet.Cell-class）中写到，单元格类型为3表示这个单元格中包含日期数据。" target="_blank" rel="noopener">https://secure.simplistix.co.uk/svn/xlrd/trunk/xlrd/doc/xlrd.html?p=4966#sheet.Cell-class）中写到，单元格类型为3表示这个单元格中包含日期数据。</a>  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if row_list:</span><br><span class="line">    data.append(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们为输入文件的每一行都创建空列表<code>row_list</code>，但是只使用值填充某些空列表。对于输入文件的每一行，这里的<code>if</code>语句判断<code>row_list</code>是否为空，如果非空，则将其添加到<code>data</code>中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for list_index, output_list in enumerate(data):</span><br><span class="line">    for element_index, element in enumerate(output_list):</span><br><span class="line">        output_worksheet.write(list_index, element_index, element)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们在<code>data</code>中的各个列表之间和列表中的各个值之间进行迭代，将这些值写入输出文件。<br>&emsp;&emsp;将要保留的行追加到<code>data</code>中的原因是，这样可以得到新的连续的行索引值。于是，当我们将这些行写入输出文件时，它们看上去就像是一个连续的整体，行与行之间不会出现缺口。否则，如果在主体<code>for</code>循环中处理各行的时候就将它们写入输出文件的话，那么xlwt的<code>write()</code>函数就会使用输入文件中原来的行索引值将行写入输出文件，造成行与行之间的缺口。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200202215848893.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-2-行中的值满足某个条件（pandas）"><a href="#1-2-行中的值满足某个条件（pandas）" class="headerlink" title="1.2 行中的值满足某个条件（pandas）"></a>1.2 行中的值满足某个条件（pandas）</h4><p>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">data_frame_value_meets_condition = data_frame[&apos;Sale Amount&apos;] = data_frame[&apos;Sale Amount&apos;].str.replace(r&apos;\$&apos;, &apos;&apos;)</span><br><span class="line">data_frame[&apos;Sale Amount&apos;] = data_frame[&apos;Sale Amount&apos;].str.replace(&apos;,&apos;, &apos;&apos;)</span><br><span class="line">data_frame[&apos;Sale Amount&apos;] = data_frame[&apos;Sale Amount&apos;].astype(float)</span><br><span class="line">data_frame_value_meets_condition = data_frame[data_frame[&apos;Sale Amount&apos;].astype(float) &gt; 1400.0]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_value_meets_condition.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行脚本，得到的输出文件如下：<br><img src="https://img-blog.csdnimg.cn/20200203112451896.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-1-行中的值属于某个集合（基础Python）"><a href="#2-1-行中的值属于某个集合（基础Python）" class="headerlink" title="2.1 行中的值属于某个集合（基础Python）"></a>2.1 行中的值属于某个集合（基础Python）</h4><p>&emsp;&emsp;接下来，我们来筛选出<code>january_2013</code>工作表中购买日期属于<code>1/24/2013</code>和<code>1/31/2013</code>的行。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">important_dates = [&apos;01/24/2013&apos;, &apos;01/31/2013&apos;]</span><br><span class="line">purchase_date_column_index = 4</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = []</span><br><span class="line">    header = worksheet.row_values(0)</span><br><span class="line">    data.append(header)</span><br><span class="line">    for row_index in range(1, worksheet.nrows):</span><br><span class="line">        purchase_datetime = xldate_as_tuple(worksheet.cell_value(row_index, purchase_date_column_index),</span><br><span class="line">                                            workbook.datemode)</span><br><span class="line">        purchase_date = date(*purchase_datetime[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">        row_list = []</span><br><span class="line">        if purchase_date in important_dates:</span><br><span class="line">            for column_index in range(worksheet.ncols):</span><br><span class="line">                cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                if cell_type == 3:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">        if row_list:</span><br><span class="line">            data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在跟着书上的代码学习时，书上的代码有一些印刷错误，这让我踩了不少的坑。上面的代码是在PyCharm 2019.3.2(Professional Edition) + Anaconda环境下成功运行的。感谢实验室的学长的指导。  </p>
</blockquote>
<p>&emsp;&emsp;这个脚本与基于条件筛选行的脚本非常相似，这里只对有差别的部分做一下简单的解释。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">important_dates = [&apos;01/24/2013&apos;, &apos;01/31/2013&apos;]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码创建了列表<code>important_dates</code>，里面包含了要使用的日期。<strong>这里需要注意的一点是，日期不能写成类似于’1/24/2013’的格式，否则会出问题！</strong><br>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件如下：<br><img src="https://img-blog.csdnimg.cn/20200203193534268.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-2-行中的值属于某个集合（pandas）"><a href="#2-2-行中的值属于某个集合（pandas）" class="headerlink" title="2.2 行中的值属于某个集合（pandas）"></a>2.2 行中的值属于某个集合（pandas）</h4><p>&emsp;&emsp;如果使用pandas模块的话，我们想筛选出特定的日期，需要用到函数<code>isin()</code>。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">important_dates = [&apos;01/24/2013&apos;, &apos;01/31/2013&apos;]</span><br><span class="line">data_frame_value_in_set = data_frame[data_frame[&apos;Purchase Date&apos;].isin(important_dates)]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_value_in_set.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/20200203194720822.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3-1-行中的值匹配于特定模式（基础Python）"><a href="#3-1-行中的值匹配于特定模式（基础Python）" class="headerlink" title="3.1 行中的值匹配于特定模式（基础Python）"></a>3.1 行中的值匹配于特定模式（基础Python）</h4><p>&emsp;&emsp;要想使行中的值匹配于特定模式，我们需要引入正则表达式。下面的代码将会筛选出表格中客户姓名以大写字母’J’开头的行。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook, xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">pattern = re.compile(r&apos;(?P&lt;my_pattern&gt;^J.*)&apos;)</span><br><span class="line">customer_name_column_index = 1</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = []</span><br><span class="line">    header = worksheet.row_values(0)</span><br><span class="line">    data.append(header)</span><br><span class="line">    for row_index in range(1, worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        if pattern.search(worksheet.cell_value(row_index, customer_name_column_index)):</span><br><span class="line">            for column_index in range(worksheet.ncols):</span><br><span class="line">                cell_value = worksheet.cell_value(row_index, column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index, column_index)</span><br><span class="line">                if cell_type == 3:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value, workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">        if row_list:</span><br><span class="line">            data.append(row_list)</span><br><span class="line">    for list_index, output_list in enumerate(data):</span><br><span class="line">        for element_index, element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index, element_index, element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们只对正则表达式的部分做一个说明。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pattern = re.compile(r&apos;(?P&lt;my_pattern&gt;^J.*)&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用re模块的<code>compile()</code>函数创建了一个正则表达式<code>pattern</code>。其中，<code>r</code>表示单引号之间的模式是一个原始字符串。元字符<code>?P&lt;my_pattern&gt;</code>捕获了名为<code>&lt;my_pattern&gt;</code>的组中匹配了的子字符串。我们要搜索的实际模式是<code>^J.*</code>。插入符号<code>^</code>表示在字符串开头搜索模式，句点<code>.</code>可以匹配任何除了换行符<code>\n</code>的字符，星号<code>*</code>则表示重复前面的字符0次或更多次。<code>.*</code>组合在一起使用表示除换行符<code>\n</code>之外的任意字符可以在J后面出现任意次。<br>&emsp;&emsp;有关正则表达式的内容，可以参考我之前写的博客：<a href="https://blog.csdn.net/qq_45554010/article/details/104022260" target="_blank" rel="noopener">Python与正则表达式</a>。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，得到输出文件。<br><img src="https://img-blog.csdnimg.cn/2020020320050554.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3-2-行中的值匹配于特定模式（pandas）"><a href="#3-2-行中的值匹配于特定模式（pandas）" class="headerlink" title="3.2 行中的值匹配于特定模式（pandas）"></a>3.2 行中的值匹配于特定模式（pandas）</h4><p>&emsp;&emsp;pandas模块提供了若干字符串和正则表达式函数，如<code>startswith()</code>, <code>endswith()</code>, <code>match()</code>和<code>search()</code>等。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file, &apos;january_2013&apos;, index_col=None)</span><br><span class="line">data_frame_value_matcher_pattern = data_frame[data_frame[&apos;Customer Name&apos;].str.startswith(&quot;J&quot;)]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_value_matcher_pattern.to_excel(writer, sheet_name=&apos;jan_13_output&apos;, index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在命令行窗口中运行脚本，得到输出文件如下：<br><img src="https://img-blog.csdnimg.cn/20200203201859574.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/01/28/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(1)/">
                Python数据分析基础之Excel文件(1)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-01-28</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <blockquote>
<p>参考资料：<br>《Python数据分析基础》，作者[美]Clinton W. Brownley，译者陈光欣，中国工信出版集团，人民邮电出版社</p>
</blockquote>
<h2 id="Excel文件简述"><a href="#Excel文件简述" class="headerlink" title="Excel文件简述"></a>Excel文件简述</h2><p>&emsp;&emsp;Microsoft Excel是Microsoft为使用Windows和Apple Macintosh操作系统的电脑编写的一款电子表格软件，它几乎无处不在，是商业活动中不可或缺的工具。使用Python可以处理Excel文件中的数据。<br>&emsp;&emsp;与Python的csv模块不同，Python中没有处理Excel文件的标准模块。我们需要安装xlrd和xlwt两个模块。  </p>
<h2 id="内省Excel工作簿"><a href="#内省Excel工作簿" class="headerlink" title="内省Excel工作簿"></a>内省Excel工作簿</h2><p>&emsp;&emsp;我们创建一个Excel工作簿，并在其中添加3个独立的工作表，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200128212600770.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200128212621474.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200128212629366.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">&emsp;&emsp;Excel文件与CSV文件至少在两个重要方面有所不同。首先，CSV文件是纯文本文件，而Excel文件不是纯文本文件，我们不能在文本编辑器中打开它并查看数据。其次，与CSV文件不同，一个Excel工作簿被设计成包含多个工作表。<br>&emsp;&emsp;通过内省一个工作簿，我们可以在实际开始处理工作簿中的数据之前，检查工作表的数目和每个工作表中的数据类型和数据量。<br>&emsp;&emsp;下面我们使用Python分析上面的工作簿，来确定工作簿中工作表的数量、名称和每个工作表中行列的数量。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from xlrd import open_workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line"></span><br><span class="line">workbook = open_workbook(input_file)</span><br><span class="line">print(&apos;Number of worksheets: &apos;, workbook.nsheets)</span><br><span class="line">for worksheet in workbook.sheets():</span><br><span class="line">    print(&quot;Worksheet name: &quot;, worksheet.name, &quot;\tRows: &quot;, worksheet.nrows, &quot;\tColumns: &quot;, worksheet.ncols)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from xlrd import open_workbook</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码导入xlrd模块的<code>open_workbook()</code>函数来读取和分析Excel文件。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">workbook = open_workbook(input_file)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用<code>open_workbook()</code>函数打开一个Excel输入文件，并赋给对象<code>workbook</code>。可以使用这个对象从工作簿中得到单独的工作表。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for worksheet in workbook.sheets():</span><br><span class="line">    print(&quot;Worksheet name: &quot;, worksheet.name, &quot;\tRows: &quot;, worksheet.nrows, &quot;\tColumns: &quot;, worksheet.ncols)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>for</code>循环语句在工作簿中的所有工作表之间迭代。<code>workbook</code>对象的<code>sheets()</code>方法可以识别出工作簿中所有的工作表。<code>print</code>语句使用<code>workbook</code>对象的<code>name</code>, <code>nrows</code>, <code>ncols</code>属性来确定每个工作表的名称以及行与列的数量。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，得到下面的输出结果。<br><img src="https://img-blog.csdnimg.cn/2020012821403180.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/01/26/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BCSV%E6%96%87%E4%BB%B6(6)/">
                Python数据分析基础之CSV文件(6)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-01-26</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>&emsp;&emsp;之前的5篇文章全部讲的是处理单个CSV文件。但是，在大多数情况下，我们需要处理很多文件，而手工处理效率低，或者文件多到手工处理根本行不通。在这种情况下，使用Python可以规模化地处理文件，减少了人为工作量的同时，也有效地减少了人为犯错的概率。<br>&emsp;&emsp;为了规模化地处理CSV文件，我们需要使用Python内置的glob模块。我们使用下面的语句来导入该模块：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import glob</span><br></pre></td></tr></table></figure>
<h2 id="读取多个CSV文件"><a href="#读取多个CSV文件" class="headerlink" title="读取多个CSV文件"></a>读取多个CSV文件</h2><p>&emsp;&emsp;在本例中，我们需要先新建3个CSV文件，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200126172215597.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/2020012617224251.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200126172308766.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;我们先从最简单的行列计数开始。尽管有些时候我们知道要处理的文件中的内容，但在多数情况下，文件是别人发送给我们的，我们不会立即知道文件中的内容。因此，行列计数是最简单的，也是最重要的。<br>&emsp;&emsp;我们编写下列代码，来读取上面创建的3个CSV文件。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import glob</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_path = sys.argv[1]</span><br><span class="line"></span><br><span class="line">file_counter = 0</span><br><span class="line">for input_file in glob.glob(os.path.join(input_path, &apos;sales_*&apos;)):</span><br><span class="line">    row_counter = 1</span><br><span class="line">    with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file)</span><br><span class="line">        header = next(filereader, None)</span><br><span class="line">        for row in filereader:</span><br><span class="line">            row_counter += 1</span><br><span class="line">    print(&apos;&#123;0!s&#125;: \t&#123;1:d&#125; rows \t&#123;2:d&#125; columns&apos;.format(os.path.basename(input_file), row_counter, len(header)))</span><br><span class="line">    file_counter += 1</span><br><span class="line">print(&apos;Number of files: &#123;0:d&#125;&apos;.format(file_counter))</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码导入了Python内置的os模块，它提供的函数可以列出和解析我们要处理的文件路径名。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for input_file in glob.glob(os.path.join(input_path, &apos;sales_*&apos;)):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里创建了一个<code>for</code>循环，它将数据处理扩展到多个文件中。os模块中的<code>os.path.join()</code>函数将圆括号中的两部分连在一起，其中<code>input_path</code>是包含输入文件的文件夹的路径，<code>sales_*</code>表示任何以模式<code>sales_</code>开头的文件名。glob模块中的<code>glob.glob()</code>函数将<code>sales_*</code>中的<code>*</code>转换为实际的文件名。也就是说，在这个例子中，<code>glob.glob()</code>和<code>os.path.join()</code>两个函数创建了一个包含3个输入文件的列表。然后，<code>for</code>循环语句对于列表中每个输入文件执行下面缩进的各行代码。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本。<br><img src="https://img-blog.csdnimg.cn/20200126173802298.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>&emsp;&emsp;可以看到，输出结果显示脚本处理了3个文件，每个文件都有7行和5列。  </p>
<h2 id="从多个文件中连接数据"><a href="#从多个文件中连接数据" class="headerlink" title="从多个文件中连接数据"></a>从多个文件中连接数据</h2><p>&emsp;&emsp;上面讲了如何读取多个CSV文件，接下来讨论如何把多个CSV文件中的数据连接起来。  </p>
<h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import glob</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_path = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">first_file = True</span><br><span class="line">for input_file in glob.glob(os.path.join(input_path, &apos;sales_*&apos;)):</span><br><span class="line">    print(os.path.basename(input_file))</span><br><span class="line">    with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">        with open(output_file, &apos;a&apos;, newline=&apos;&apos;) as csv_out_file:</span><br><span class="line">            filereader = csv.reader(csv_in_file)</span><br><span class="line">            filewriter = csv.writer(csv_out_file)</span><br><span class="line">            if first_file:</span><br><span class="line">                for row in filereader:</span><br><span class="line">                    filewriter.writerow(row)</span><br><span class="line">                first_file = False</span><br><span class="line">            else:</span><br><span class="line">                header = next(filereader, None)</span><br><span class="line">                for row in filereader:</span><br><span class="line">                    filewriter.writerow(row)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">with open(output_file, &apos;a&apos;, newline=&apos;&apos;) as csv_out_file:</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;和之前不同，这里<code>open()</code>函数中的参数不是<code>&#39;w&#39;</code>（可写）而是<code>&#39;a&#39;</code>（追加）。这里为什么不用可写模式呢？我们先来讨论一下可写模式和追加模式的区别。<br>模式|描述<br>——|——<br>w|打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。<br>a|打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。<br>&emsp;&emsp;使用追加模式，每个输入文件中的数据可以追加（也就是添加）到输出文件中。而如果使用可写模式，从一个输入文件中输出的数据会覆盖掉前一个输入文件中的数据，最后的输出文件会只包含最后处理的那个输入文件中的数据。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">first_file = True</span><br><span class="line">for input_file in glob.glob(os.path.join(input_path, &apos;sales_*&apos;)):</span><br><span class="line">    ...</span><br><span class="line">            if first_file:</span><br><span class="line">                for row in filereader:</span><br><span class="line">                    filewriter.writerow(row)</span><br><span class="line">                first_file = False</span><br><span class="line">            else:</span><br><span class="line">                header = next(filereader, None)</span><br><span class="line">                for row in filereader:</span><br><span class="line">                    filewriter.writerow(row)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里的<code>if-else</code>语句根据前面创建的<code>first_file</code>变量来区分当前文件是否为第一个输入文件。做这个区分的目的是将标题行仅写入输出文件一次，避免重复输入。<code>if</code>代码块处理第一个输入文件，将所有行写入输出文件。<code>else</code>代码块处理余下的输入文件，使用<code>next()</code>方法将每个输入文件中的标题行赋给变量<code>header</code>，这样就可以在后面的处理过程中跳过标题行，然后将数据行写入输出文件。<br>&emsp;&emsp;我们在命令行窗口运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200126180013163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;pandas模块可以直接从多个文件中连接数据。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import glob</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_path = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">all_files = glob.glob(os.path.join(input_path, &apos;sales_*&apos;))</span><br><span class="line">all_data_frames = []</span><br><span class="line">for file in all_files:</span><br><span class="line">    data_frame = pd.read_csv(file, index_col=None)</span><br><span class="line">    all_data_frames.append(data_frame)</span><br><span class="line">data_frame_concat = pd.concat(all_data_frames, axis=0, ignore_index=True)</span><br><span class="line">data_frame_concat.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;使用pandas模块连接多个文件中的数据，基本过程就是将每个输入文件读取到pandas数据框中，将所有数据框追加到一个数据框列表，然后使用<code>concat()</code>函数将所有数据框连接成一个数据框。<code>concat()</code>函数可以使用<code>axis</code>参数来设置连接数据框的方式，<code>axis=0</code>表示从头到尾垂直堆叠，<code>axis=1</code>表示并排地平行堆叠。<br>&emsp;&emsp;此处省略输出结果。  </p>
<h2 id="计算每个文件中值的总和与均值"><a href="#计算每个文件中值的总和与均值" class="headerlink" title="计算每个文件中值的总和与均值"></a>计算每个文件中值的总和与均值</h2><p>&emsp;&emsp;有些时候，当有多个输入文件时，需要对每个输入文件计算一些统计量，如总和、均值等。  </p>
<h4 id="1-基础Python-1"><a href="#1-基础Python-1" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import glob</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_path = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_header_list = [&apos;file_name&apos;, &apos;total_sales&apos;, &apos;average_sales&apos;]</span><br><span class="line">csv_out_file = open(output_file, &apos;a&apos;, newline=&apos;&apos;)</span><br><span class="line">filewriter = csv.writer(csv_out_file)</span><br><span class="line">filewriter.writerow(output_header_list)</span><br><span class="line">for input_file in glob.glob(os.path.join(input_path, &apos;sales_*&apos;)):</span><br><span class="line">    with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file)</span><br><span class="line">        output_list = []</span><br><span class="line">        output_list.append(os.path.basename(input_file))</span><br><span class="line">        header = next(filereader)</span><br><span class="line">        total_sales = 0.0</span><br><span class="line">        number_of_sales = 0.0</span><br><span class="line">        for row in filereader:</span><br><span class="line">            sale_amount = row[3]</span><br><span class="line">            total_sales += float(str(sale_amount).strip(&apos;$&apos;).replace(&apos;,&apos;, &apos;&apos;))</span><br><span class="line">            number_of_sales += 1</span><br><span class="line">        average_sales = &apos;&#123;0:.2f&#125;&apos;.format(total_sales / number_of_sales)</span><br><span class="line">        output_list.append(total_sales)</span><br><span class="line">        output_list.append(average_sales)</span><br><span class="line">        filewriter.writerow(output_list)</span><br><span class="line">csv_out_file.close()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">output_header_list = [&apos;file_name&apos;, &apos;total_sales&apos;, &apos;average_sales&apos;]</span><br><span class="line">csv_out_file = open(output_file, &apos;a&apos;, newline=&apos;&apos;)</span><br><span class="line">filewriter = csv.writer(csv_out_file)</span><br><span class="line">filewriter.writerow(output_header_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里创建了一个输出文件的列标题列表<code>output_header_list</code>，并创建<code>filewriter</code>对象，使用<code>writerow()</code>将标题行写入输出文件。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">output_list = []</span><br><span class="line">output_list.append(os.path.basename(input_file))</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里创建了一个空列表<code>output_list</code>，保存要写入输出文件中的每行输出。下面一行代码将输入文件的文件名追加到<code>output_list</code>中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header = next(filereader)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用<code>next()</code>函数除去每个输入文件的标题行。<br>&emsp;&emsp;之后的代码内容和之前学习过的内容类似，代码本身也比较简单易懂，故在此不再赘述。<br>&emsp;&emsp;我们在命令行窗口运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200126212653946.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas-1"><a href="#2-pandas-1" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;pandas模块中提供了一些摘要统计函数，比如<code>sum()</code>和<code>mean()</code>。使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import glob</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_path = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">all_files = glob.glob(os.path.join(input_path, &apos;sales_*&apos;))</span><br><span class="line">all_data_frames = []</span><br><span class="line">for input_file in all_files:</span><br><span class="line">    data_frame = pd.read_csv(input_file, index_col=None)</span><br><span class="line">    total_sales = pd.DataFrame([float(str(value).strip(&apos;$&apos;).replace(&apos;,&apos;, &apos;&apos;))</span><br><span class="line">                                for value in data_frame.loc[:, &apos;Sale Amount&apos;]]).sum()</span><br><span class="line">    average_sales = pd.DataFrame([float(str(value).strip(&apos;$&apos;).replace(&apos;,&apos;, &apos;&apos;))</span><br><span class="line">                                for value in data_frame.loc[:, &apos;Sale Amount&apos;]]).mean()</span><br><span class="line">    data = &#123;&apos;file_name&apos;: os.path.basename(input_file),</span><br><span class="line">            &apos;total_sales&apos;: total_sales,</span><br><span class="line">            &apos;average_sales&apos;: average_sales&#125;</span><br><span class="line">    all_data_frames.append(pd.DataFrame(data, columns=[&apos;file_name&apos;, &apos;total_sales&apos;, &apos;average_sales&apos;]))</span><br><span class="line">    data_frames_concat = pd.concat(all_data_frames, axis=0, ignore_index=True)</span><br><span class="line">    data_frames_concat.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;使用列表生成式将销售额这一列中带<code>$</code>的字符转换为浮点数，然后使用数据框函数将这个对象转换为一个DataFrame，以便可以使用<code>sum()</code>和<code>mean()</code>这两个函数计算列的总计和均值。因为输出文件中的每行应该包含输入文件名，以及文件中销售额的总计和均值，所以可以将这3种数据组合成一个文本框，使用<code>concat()</code>函数将这些数据框连接成为一个数据框，并将这个数据框写入文件。<br>&emsp;&emsp;此处省略输出结果。  </p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>&emsp;&emsp;以上就是Python数据分析中有关CSV文件的全部内容。由于本人能力有限，学习时间也比较短，难免出现纰漏，如果发现还请指正。<br>&emsp;&emsp;我的邮箱：<a href="mailto:1398635912@qq.com" target="_blank" rel="noopener">1398635912@qq.com</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/01/24/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BCSV%E6%96%87%E4%BB%B6(5)/">
                Python数据分析基础之CSV文件(5)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-01-24</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="选取连续的行"><a href="#选取连续的行" class="headerlink" title="选取连续的行"></a>选取连续的行</h2><p>&emsp;&emsp;有时，工作表的头部和尾部是我们不想处理的。在很多情况下，工作表头部是标题、作者信息等，尾部是来源、假设、附加说明、注意事项等，我们并不需要处理这些内容。在这时，我们可以用Python来选取CSV文件中连续的行。<br>&emsp;&emsp;我们把之前的supplier_data.csv文件打开，在工作表头部和尾部分别加入一些不需要处理的内容，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200124103815623.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;要使用基础Python选取特定的行，我们需要创建一个变量<code>row_counter</code>来跟踪行索引。在上面的示例中，我们知道应该保留行索引大于或等于3并且小于或等于15的行。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">row_counter = 0</span><br><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as csv_out_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file)</span><br><span class="line">        filewriter = csv.writer(csv_out_file)</span><br><span class="line">        for row in filereader:</span><br><span class="line">            if 3 &lt;= row_counter &lt;= 15:</span><br><span class="line">                filewriter.writerow([value.strip() for value in row])</span><br><span class="line">            row_counter += 1</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果我们对比一下之前的读写CSV文件的代码，不难发现上面的这个代码只是在原来的基础上稍微做了一下改动，引入变量<code>row_counter</code>，并且在遍历输入文件中所有的行时使用<code>if</code>语句跳过不需要的头部和尾部内容，只保留需要的行。<br>&emsp;&emsp;对于输入文件的前3行，行索引值为0,1,2，此时<code>if</code>的判断结果为<code>False</code>，所以不执行<code>if</code>代码块，并将<code>row_counter</code>的值加1。对于输入文件的最后3行，行索引值为16,17,18，<code>if</code>的判断结果也是<code>False</code>，也不执行<code>if</code>代码块，并将<code>row_counter</code>的值加1。<br>&emsp;&emsp;而对于想要保留的行，它们的行索引值为3~15，即<code>row_counter</code>在3和15之间。此时<code>if</code>判断结果为<code>True</code>，执行<code>if</code>代码块，处理这些行并将其写入输出文件。在列表生成式中，使用<code>strip()</code>函数除去每行两端的空格、制表符和换行符。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200124111120350.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;在pandas模块中，<code>drop()</code>函数可以根据行索引或列标题来丢弃行或列。也就是说，我们只需要使用<code>drop</code>函数丢弃掉前3行和后3行（即行索引为0,1,2,16,17,18的行）即可达到目的。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_csv(input_file, header=None)</span><br><span class="line">data_frame = data_frame.drop([0, 1, 2, 16, 17, 18])</span><br><span class="line">data_frame.columns = data_frame.iloc[0]</span><br><span class="line">data_frame = data_frame.reindex(data_frame.index.drop(3))</span><br><span class="line">data_frame.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;pandas模块中的<code>iloc</code>函数功能强大，它可以根据行索引选取一个单独行作为列索引。<code>reindex()</code>函数可以为数据框重新生成索引。<br>&emsp;&emsp;此处省略输出结果。  </p>
<h2 id="添加标题行"><a href="#添加标题行" class="headerlink" title="添加标题行"></a>添加标题行</h2><p>&emsp;&emsp;有些时候，电子表格没有标题行，而我们却希望所有列都有列标题。使用Python脚本可以添加列标题。<br>&emsp;&emsp;我们打开supplier_data.csv文件。删除掉标题行，并将其保存为supplier_data_no_header_row.csv。<br><img src="https://img-blog.csdnimg.cn/20200124112545166.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="1-基础Python-1"><a href="#1-基础Python-1" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as csv_out_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file)</span><br><span class="line">        filewriter = csv.writer(csv_out_file)</span><br><span class="line">        header_list = [&apos;Supplier Name&apos;, &apos;Invoice Number&apos;, &apos;Part Number&apos;, &apos;Cost&apos;, &apos;Purchase Date&apos;]</span><br><span class="line">        filewriter.writerow(header_list)</span><br><span class="line">        for row in filereader:</span><br><span class="line">            filewriter.writerow(row)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在上面的代码中，创建了一个列表变量<code>header_list</code>，其中包含了作为列标题的5个字符串。<code>writerow()</code>函数将这些列表值写入输出文件的第一行。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200124113200888.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas-1"><a href="#2-pandas-1" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;pandas模块中的<code>read_csv()</code>函数可以直接指定输入文件不包含标题行，并可以提供一个列标题列表。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">header_list = [&apos;Supplier Name&apos;, &apos;Invoice Number&apos;, &apos;Part Number&apos;, &apos;Cost&apos;, &apos;Purchase Date&apos;]</span><br><span class="line">data_frame = pd.read_csv(input_file, header=None, names=header_list)</span><br><span class="line">data_frame.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;此处省略输出结果。  </p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/01/23/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BCSV%E6%96%87%E4%BB%B6(4)/">
                Python数据分析基础之CSV文件(4)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-01-23</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>&emsp;&emsp;有些时候，我们也并不需要文件中所有的列。有两种方法可以在CSV文件中选取特定的列：<br>&emsp;&emsp;1.使用列索引值；<br>&emsp;&emsp;2.使用列标题。  </p>
<h2 id="使用列索引值"><a href="#使用列索引值" class="headerlink" title="使用列索引值"></a>使用列索引值</h2><h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;举个例子，在之前的CSV文件中，我们只想保留供应商姓名和成本这两列，使用Python编辑代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">my_columns = [0, 3]</span><br><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as csv_out_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file)</span><br><span class="line">        filewriter = csv.writer(csv_out_file)</span><br><span class="line">        for row_list in filereader:</span><br><span class="line">            row_list_output = []</span><br><span class="line">            for index_value in my_columns:</span><br><span class="line">                row_list_output.append(row_list[index_value])</span><br><span class="line">            filewriter.writerow(row_list_output)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_columns = [0, 3]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码创建了一个列表变量<code>my_columns</code>，其中包含了想要保留的两列的索引值，分别对应供应商姓名和成本两列。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for row_list in filereader:</span><br><span class="line">    row_list_output = []</span><br><span class="line">    for index_value in my_columns:</span><br><span class="line">        row_list_output.append(row_list[index_value])</span><br><span class="line">    filewriter.writerow(row_list_output)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在这个<code>for</code>循环中，首先创建了一个空列表变量<code>row_list_output</code>，保存每行中想要保留的值。在内层的<code>for</code>循环语句中，在<code>my_columns</code>中的各个索引值之间进行迭代，通过<code>append()</code>函数使用每行中<code>my_columns</code>索引位置的值为<code>row_list_output</code>填充元素。这几行代码生成了一个列表，其中包含了每行中要写入输出文件的值。<code>filewriter</code>的<code>writerow()</code>方法需要一个字符串序列或数值序列，而列表<code>row_list_out</code>正是一个字符串序列。<br>&emsp;&emsp;第一次循环时，<code>index_value</code>等于0，<code>append()</code>函数将<code>row[0]</code>加入<code>row_list_output</code>。此后，代码回到<code>for index_value ...</code>行，此时<code>index_value</code>等于3，<code>append()</code>函数将<code>row[3]</code>加入<code>row_list_output</code>。这时，内层<code>for</code>循环结束，代码前进到最后一行，<code>writerow()</code>将<code>row_list_output</code>中的列表值写入输出文件。然后，代码回到外层<code>for</code>循环，开始处理输入文件中的下一行。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200123175303606.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_csv(input_file)</span><br><span class="line">data_frame_column_by_index = data_frame.iloc[:, [0, 3]]</span><br><span class="line">data_frame_column_by_index.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在上述代码中，<code>iloc</code>函数根据索引位置选取列。<br>&emsp;&emsp;此处省略输出结果。  </p>
<h2 id="使用列标题"><a href="#使用列标题" class="headerlink" title="使用列标题"></a>使用列标题</h2><p>&emsp;&emsp;当想保留的列的标题非常容易识别，或者在处理多个输入文件时，各个输入文件中列的位置会发生改变，但标题不变的时候，使用列标题来选取特定的列的方法非常有效。  </p>
<h4 id="1-基础Python-1"><a href="#1-基础Python-1" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;举个例子，在前面的CSV文件中，我们只想保留发票号码和购买日期两列，代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">my_columns = [&apos;Invoice Number&apos;, &apos;Purchase Date&apos;]</span><br><span class="line">my_columns_index = []</span><br><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as csv_out_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file)</span><br><span class="line">        filewriter = csv.writer(csv_out_file)</span><br><span class="line">        header = next(filereader, None)</span><br><span class="line">        for index_value in range(len(header)):</span><br><span class="line">            if header[index_value] in my_columns:</span><br><span class="line">                my_columns_index.append(index_value)</span><br><span class="line">        filewriter.writerow(my_columns)</span><br><span class="line">        for row_list in filereader:</span><br><span class="line">            row_list_output = []</span><br><span class="line">            for index_value in my_columns_index:</span><br><span class="line">                row_list_output.append(row_list[index_value])</span><br><span class="line">            filewriter.writerow(row_list_output)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_columns = [&apos;Invoice Number&apos;, &apos;Purchase Date&apos;]</span><br><span class="line">my_columns_index = []</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里创建了一个列表变量<code>my_columns</code>，其中包含的两个字符串即要保留的两列的名字。下面创建的空列表变量<code>my_columns_index</code>要使用两个保留列的索引值来填充。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header = next(filereader, None)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用<code>next()</code>函数从输入文件中读取第一行，并保存在列表变量<code>header</code>中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">for index_value in range(len(header)):</span><br><span class="line">    if header[index_value] in my_columns:</span><br><span class="line">        my_columns_index.append(index_value)</span><br><span class="line">filewriter.writerow(my_columns)</span><br><span class="line">for row_list in filereader:</span><br><span class="line">    row_list_output = []</span><br><span class="line">    for index_value in my_columns_index:</span><br><span class="line">        row_list_output.append(row_list[index_value])</span><br><span class="line">    filewriter.writerow(row_list_output)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这几行代码与上一种方法的代码思路类似，在此不再赘述。<br>&emsp;&emsp;在命令行窗口中运行这个脚本，并打开输出文件查看结果。<br><img src="https://img-blog.csdnimg.cn/20200123182213177.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas-1"><a href="#2-pandas-1" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_csv(input_file)</span><br><span class="line">data_frame_column_by_name = data_frame.loc[:, [&apos;Invoice Number&apos;, &apos;Purchase Date&apos;]]</span><br><span class="line">data_frame_column_by_name.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在上面的代码中，使用<code>loc</code>函数来选取列。<br>&emsp;&emsp;此处省略输出结果。  </p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/01/20/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BCSV%E6%96%87%E4%BB%B6(3)/">
                Python数据分析基础之CSV文件(3)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-01-20</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>&emsp;&emsp;这一节主要讲一下在读写CSV文件时筛选特定的行。<br>&emsp;&emsp;有些时候，我们并不需要文件中所有的数据。例如，我们可能只需要一个包含特定词或数字的行的子集，或者是与某个具体日期关联的行的子集。在这些情况下，我们可以用Python筛选出特定的行来使用。<br>&emsp;&emsp;下面主要来讲在输入文件中筛选出特定行的3种方法：<br>&emsp;&emsp;1.行中的值满足某个条件；<br>&emsp;&emsp;2.行中的值属于某个集合；<br>&emsp;&emsp;3.行中的值匹配于某个模式（正则表达式）。<br>&emsp;&emsp;其实，这三种筛选方法的代码在结构上是一致的。通用结构如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for row in filereader:</span><br><span class="line">    ***if value in row meets some business rule or set of rules:***</span><br><span class="line">        do something</span><br><span class="line">    else:</span><br><span class="line">        do something else</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;下面我们来详细讨论一下上述3种方法。  </p>
<h2 id="行中的值满足某个条件"><a href="#行中的值满足某个条件" class="headerlink" title="行中的值满足某个条件"></a>行中的值满足某个条件</h2><h4 id="1-基础Python"><a href="#1-基础Python" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;在之前的样例中，如果我们只想保留供应商名字为Supplier Z或成本大于$600.00的行，并将结果写入输出文件。代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as csv_out_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file)</span><br><span class="line">        filewriter = csv.writer(csv_out_file)</span><br><span class="line">        header = next(filereader)</span><br><span class="line">        filewriter.writerow(header)</span><br><span class="line">        for row_list in filereader:</span><br><span class="line">            supplier = str(row_list[0]).strip()</span><br><span class="line">            cost = str(row_list[3]).strip(&apos;$&apos;).replace(&apos;,&apos;, &apos;&apos;)</span><br><span class="line">            if supplier == &apos;Supplier Z&apos; or float(cost) &gt; 600.0:</span><br><span class="line">                filewriter.writerow(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">header = next(filereader)</span><br><span class="line">filewriter.writerow(header)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这两行代码使用csv模块的<code>next()</code>函数读出输入文件的第一行，赋给列表变量<code>header</code>，并且使用<code>writerow()</code>函数将标题行写入输出文件。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supplier = str(row_list[0]).strip()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码取出每行数据中的供应商名字，赋给变量<code>supplier</code>。这行代码使用列表索引取出每行数据的第一个值<code>row[0]</code>，使用<code>str()</code>函数将其转换为一个字符串，再使用<code>strip()</code>函数删除字符串两端的空格、制表符和换行符。最后，将处理好的字符串赋给变量<code>supplier</code>。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cost = str(row_list[3]).strip(&apos;$&apos;).replace(&apos;,&apos;, &apos;&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码取出每行数据中的成本，赋给变量<code>cost</code>。这行代码使用列表索引取出每行数据的第四个值<code>row[3]</code>，使用<code>str()</code>函数将其转换为一个字符串，再使用<code>strip(&#39;$&#39;)</code>函数从字符串中删除<code>$</code>符号，再使用<code>replace()</code>函数从字符串中删除逗号。最后，将处理好的字符串赋给变量<code>cost</code>。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if supplier == &apos;Supplier Z&apos; or float(cost) &gt; 600.0:</span><br><span class="line">    filewriter.writerow(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这两行代码通过创建<code>if</code>语句来检验每行中的这两个值是否满足条件，若条件满足，则使用<code>filewriter</code>的<code>writerow()</code>函数将其写入输出文件。<br>&emsp;&emsp;我们在命令行窗口运行这个脚本。在窗口中没有任何输出，我们可以打开输出文件来查看结果。<br><img src="https://img-blog.csdnimg.cn/20200120205540611.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas"><a href="#2-pandas" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;pandas模块提供了一个<code>loc</code>函数，它可以同时选择特定的行与列。使用pandas模块的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_csv(input_file)</span><br><span class="line">data_frame[&apos;Cost&apos;] = data_frame[&apos;Cost&apos;].str.strip(&apos;$&apos;).astype(float)</span><br><span class="line">data_frame_value_meets_condition = data_frame.loc[(data_frame[&apos;Supplier Name&apos;].str.contains(&apos;Z&apos;))</span><br><span class="line">                                                  | (data_frame[&apos;Cost&apos;] &gt; 600.0), :]</span><br><span class="line">data_frame_value_meets_condition.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们在命令行窗口运行这个脚本，同样地，在屏幕上我们看不到任何输出，我们可以打开输出文件查看结果。<br>&emsp;&emsp;此处省略输出结果。  </p>
<h2 id="行中的值属于某个集合"><a href="#行中的值属于某个集合" class="headerlink" title="行中的值属于某个集合"></a>行中的值属于某个集合</h2><p>&emsp;&emsp;有些时候，当行中的值属于某个集合时，才需要保留这些行。例如，我们希望在数据集中保留那些供应商名字属于集合<code>{Supplier X, Supplier Y}</code>的行，或者希望保留所有购买日期属于集合<code>{&#39;1/20/2014&#39;, &#39;1/30/2014&#39;}</code>的行。在这种情况下，我们可以检验行中的值是否属于某个集合，筛选出具有属于该集合的行。  </p>
<h4 id="1-基础Python-1"><a href="#1-基础Python-1" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">important_dates = [&apos;1/20/2014&apos;, &apos;1/30/2014&apos;]</span><br><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as csv_out_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file)</span><br><span class="line">        filewriter = csv.writer(csv_out_file)</span><br><span class="line">        header = next(filereader)</span><br><span class="line">        filewriter.writerow(header)</span><br><span class="line">        for row_list in filereader:</span><br><span class="line">            a_date = row_list[4]</span><br><span class="line">            if a_date in important_dates:</span><br><span class="line">                filewriter.writerow(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来讨论一下上述代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">important_dates = [&apos;1/20/2014&apos;, &apos;1/30/2014&apos;]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码创建了一个名为<code>important_dates</code>的列表变量，其中包含了两个特定日期。这个列表变量就是我们的集合。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a_date = row_list[4]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码取出每一行的购买日期，并赋给变量<code>a_date</code>。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if a_date in important_dates:</span><br><span class="line">    filewriter.writerow(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码创建了一个<code>if</code>语句来检验变量<code>a_date</code>中的购买日期是否属于集合<code>important_date</code>，如果变量值在集合中，下一行代码就将这一行写入输出文件。<br>&emsp;&emsp;我们在命令行窗口中运行这个脚本，并打开输出文件来查看结果。<br><img src="https://img-blog.csdnimg.cn/20200120211035351.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas-1"><a href="#2-pandas-1" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;使用pandas模块的代码如下所示：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_csv(input_file)</span><br><span class="line">important_dates = [&apos;1/20/2014&apos;, &apos;1/30/2014&apos;]</span><br><span class="line">data_frame_value_in_set = data_frame.loc[data_frame[&apos;Purchase Date&apos;].isin(important_dates), :]</span><br><span class="line">data_frame_value_in_set.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里的输出结果和上面基础Python方法的输出结果一致，故省略。  </p>
<h2 id="行中的值匹配于某个模式（正则表达式）"><a href="#行中的值匹配于某个模式（正则表达式）" class="headerlink" title="行中的值匹配于某个模式（正则表达式）"></a>行中的值匹配于某个模式（正则表达式）</h2><p>&emsp;&emsp;有些时候，当行中的值匹配或包含一个特定模式（正则表达式）时，才需要保留这些行。例如，我们希望在数据集中保留所有发票开始于“001-”的行，或者希望保留所有供应商名字中包含“Y”的行。在这种情况下，我们可以检验行中的值是否匹配或包含某种模式，然后筛选出匹配或包含该模式的行。  </p>
<h4 id="1-基础Python-2"><a href="#1-基础Python-2" class="headerlink" title="1.基础Python"></a>1.基础Python</h4><p>&emsp;&emsp;代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import re</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">pattern = re.compile(r&apos;(?P&lt;my_pattern_group&gt;^001-.*)&apos;, re.I)</span><br><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as csv_out_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file)</span><br><span class="line">        filewriter = csv.writer(csv_out_file)</span><br><span class="line">        header = next(filereader)</span><br><span class="line">        filewriter.writerow(header)</span><br><span class="line">        for row_list in filereader:</span><br><span class="line">            invoice_number = row_list[1]</span><br><span class="line">            if pattern.search(invoice_number):</span><br><span class="line">                filewriter.writerow(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来讨论一下上述代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这一行代码导入了re模块，也就是正则表达式模块。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pattern = re.compile(r&apos;(?P&lt;my_pattern_group&gt;^001-.*)&apos;, re.I)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用re模块的<code>compile()</code>函数创建变量<code>pattern</code>。其中<code>r</code>表示将单引号之间的模式当作原始字符串来处理。元字符<code>?P&lt;my_pattern_group&gt;</code>捕获了名为<code>&lt;my_pattern_group&gt;</code>的组中匹配了的字符串，以便在需要的时候将它们打印到屏幕或写入文件。这里要搜索的实际模式是<code>^001-.*</code>。插入符号<code>^</code>表示只在字符串开头搜索模式，<code>*</code>表示重复前面的字符0次或更多次，<code>.*</code>组合在一起使用表示除换行符<code>\n</code>之外的任意字符可以在“001-”后面出现任意次。最后，参数<code>re.I</code>告诉了正则表达式进行大小写敏感的匹配。<br>&emsp;&emsp;有关正则表达式的内容，可以参考我之前写的博客：<a href="https://blog.csdn.net/qq_45554010/article/details/104022260" target="_blank" rel="noopener">Python与正则表达式</a>。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if pattern.search(invoice_number):</span><br><span class="line">    filewriter.writerow(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里使用re模块的<code>search()</code>函数在<code>invoice_number</code>的值中寻找模式，如果模式出现在变量值中，就将这行写入输出文件。<br>&emsp;&emsp;我们在命令行窗口运行这个脚本，得到输出文件如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200120212816274.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-pandas-2"><a href="#2-pandas-2" class="headerlink" title="2.pandas"></a>2.pandas</h4><p>&emsp;&emsp;使用pandas模块的代码如下所示：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_csv(input_file)</span><br><span class="line">data_frame_value_matches_pattern = data_frame.loc[data_frame[&apos;Invoice Number&apos;].str.startswith(&quot;001-&quot;), :]</span><br><span class="line">data_frame_value_matches_pattern.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;上述代码中，<code>startswith()</code>函数用来搜索数据，不用再使用正则表达式。<br>&emsp;&emsp;这里的输出结果和上面基础Python方法的输出结果一致，故省略。  </p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/01/19/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BCSV%E6%96%87%E4%BB%B6(2)/">
                Python数据分析基础之CSV文件(2)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-01-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="基本字符串分析的失败"><a href="#基本字符串分析的失败" class="headerlink" title="基本字符串分析的失败"></a>基本字符串分析的失败</h2><p>&emsp;&emsp;在上一节我们讲了使用Python对CSV文件进行读写。事实上，当列中包含额外的逗号时，CSV分析会失败。<br>&emsp;&emsp;我们打开supplier_data.csv，将Cost列中的最后两个成本数量分别改为$6,015.00和$1,006,015.00，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200119164515385.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">&emsp;&emsp;之前的脚本是按照行中的逗号分析每行数据的，这会让脚本错误地拆分最后两行的数据，因为数据中有逗号。<br>&emsp;&emsp;有很多方法可以改进这个脚本中的代码，使它可以正确地处理包含逗号的数值。我们可以使用正则表达式，但为了不使脚本复杂化，我们可以使用Python内置的csv模块。这个模块可以方便灵活地处理复杂的CSV文件。  </p>
<h2 id="修改后的脚本读写CSV文件"><a href="#修改后的脚本读写CSV文件" class="headerlink" title="修改后的脚本读写CSV文件"></a>修改后的脚本读写CSV文件</h2><p>&emsp;&emsp;使用Python内置的csv模块处理CSV文件的一个优点是，这个模块就是被设计用于正确处理数据值中的嵌入逗号和其他复杂模式的，它可以识别出这些模式并正确地处理数据。<br>&emsp;&emsp;修改后的代码如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import csv</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as csv_in_file:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as csv_out_file:</span><br><span class="line">        filereader = csv.reader(csv_in_file, delimiter=&apos;,&apos;)</span><br><span class="line">        filewriter = csv.writer(csv_out_file, delimiter=&apos;,&apos;)</span><br><span class="line">        for row_list in filereader:</span><br><span class="line">            print(row_list)</span><br><span class="line">            filewriter.writerow(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import csv</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码导入csv模块，以便可以使用其中的函数来分析输入文件，写入输入文件。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filereader = csv.reader(csv_in_file, delimiter=&apos;,&apos;)</span><br><span class="line">filewriter = csv.writer(csv_out_file, delimiter=&apos;,&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这两行代码使用csv模块中的<code>reader()</code>函数和<code>writer()</code>函数分别创建了一个文件读取对象<code>filereader</code>和文件写入对象<code>filewriter</code>。这两个函数中的第二个参数<code>delimiter=&#39;,&#39;</code>是默认分隔符，如果输入文件和输出文件都是用逗号分隔的，就不需要指定这个参数。这里指定分隔符函数，是为了防备待处理的输入文件或要写入的输出文件具有不同的分隔符，例如分号<code>;</code>或制表符<code>\t</code>。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filewriter.writerow(row_list)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用<code>filewriter</code>对象的<code>writerow()</code>函数来将每行中的列表值写入输出文件。<br>&emsp;&emsp;我们在命令行窗口运行这个脚本，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200119170337420.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200119170405927.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/01/19/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BCSV%E6%96%87%E4%BB%B6(1)/">
                Python数据分析基础之CSV文件(1)
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-01-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <blockquote>
<p>参考资料：<br>《Python数据分析基础》，作者[美]Clinton W. Brownley，译者陈光欣，中国工信出版集团，人民邮电出版社</p>
</blockquote>
<h2 id="CSV文件简述"><a href="#CSV文件简述" class="headerlink" title="CSV文件简述"></a>CSV文件简述</h2><p>&emsp;&emsp;CSV（comma-separated value，逗号分隔值）文件格式是一种非常简单的<strong>数据存储与分享</strong>方式。CSV文件将数据表格存储为纯文本，表格（或电子表格）中的每个单元格都是一个数值或字符串。与Excel文件相比，CSV文件的一个主要优点是<strong>有很多程序可以存储、转换和处理纯文本文件</strong>；相比之下，能够处理Excel文件的程序却不多。<br>&emsp;&emsp;当我们使用CSV文件时，确实会失去某些Excel功能：在Excel电子表格中，每个单元格都有一个定义好的“类型”，<strong>CSV文件中的单元格则只是原始数据</strong>。使用CSV文件的另一个问题是<strong>它只能保存数据而不能保存公式</strong>。  </p>
<h2 id="CSV文件初体验"><a href="#CSV文件初体验" class="headerlink" title="CSV文件初体验"></a>CSV文件初体验</h2><p>&emsp;&emsp;我们打开一个电子表格，向其中加入数据，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200119001909232.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">&emsp;&emsp;把文件保存在合适的位置。我们用记事本来打开这个文件，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200119002141811.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">&emsp;&emsp;可以看到，supplier_data.csv确实是纯文本文件。  </p>
<h2 id="用Python读写CSV文件"><a href="#用Python读写CSV文件" class="headerlink" title="用Python读写CSV文件"></a>用Python读写CSV文件</h2><h4 id="1-基础Python，不使用csv模块"><a href="#1-基础Python，不使用csv模块" class="headerlink" title="1.基础Python，不使用csv模块"></a>1.基础Python，不使用csv模块</h4><p>&emsp;&emsp;我们新建一个Python脚本，命名为<code>1csv_read_with_simple_parsing_and_write.py</code>。输入以下代码：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as filereader:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as filewriter:</span><br><span class="line">        header = filereader.readline()</span><br><span class="line">        header = header.strip()</span><br><span class="line">        header_list = header.split(&apos;,&apos;)</span><br><span class="line">        print(header_list)</span><br><span class="line">        filewriter.write(&apos;,&apos;.join(map(str, header_list)) + &apos;\n&apos;)</span><br><span class="line">        for row in filereader:</span><br><span class="line">            row = row.strip()</span><br><span class="line">            row_list = row.split(&apos;,&apos;)</span><br><span class="line">            print(row_list)</span><br><span class="line">            filewriter.write(&apos;,&apos;.join(map(str, row_list)) + &apos;\n&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;下面我们来解释一下上面的代码。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这一行称为shebang行。在Python脚本中，我们应该一直把它作为第一行。以<code>#</code>开头的行为单行注释，在Windows系统中，计算机不读取也不执行这一行代码。但是，安装了Unix系统的计算机使用这一行来找到执行文件中代码的Python版本。加入这一行可以使脚本在不同操作系统的计算机之间具有可移植性。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这两行代码使用sys模块的argv参数，它是一个传递给Python脚本的命令行参数列表，也就是当你运行脚本时在命令行输入的内容。在argv这个特殊的列表中，第一个元素<code>argv[0]</code>用做脚本名称，<code>argv[1]</code>则用作CSV输入文件的路径和文件名，<code>argv[2]</code>用作CSV输出文件的路径和文件名。在上面的代码中，<code>argv[1]</code>和<code>argv[2]</code>被分别赋值给变量<code>input_file</code>和<code>output_file</code>。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(input_file, &apos;r&apos;, newline=&apos;&apos;) as filereader:</span><br><span class="line">    with open(output_file, &apos;w&apos;, newline=&apos;&apos;) as filewriter:</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里的<code>with</code>语句可以在语句结束时自动关闭文件对象。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">header = filereader.readline()</span><br><span class="line">header = header.strip()</span><br><span class="line">header_list = header.split(&apos;,&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里使用了文件对象的<code>readline</code>方法读取输入文件中的第一行数据。第一行是标题行，读入后将其作为字符串赋给变量<code>header</code>。<code>strip()</code>去掉了<code>header</code>字符串两端的空格、制表符和换行符。接下来使用<code>split(&#39;,&#39;)</code>将字符串用逗号拆分成列表并赋给变量<code>header_list</code>，列表中的每个值都是一个列标题。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filewriter.write(&apos;,&apos;.join(map(str, header_list)) + &apos;\n&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这行代码使用<code>filewriter</code>对象的<code>write()</code>方法将<code>header_list</code>中的每个值写入输出文件。<code>map()</code>函数将<code>str()</code>函数应用于<code>header_list</code>中的每个元素，确保每个元素都是字符串。<code>join()</code>函数在<code>header_list</code>中的每个值之间插入一个逗号，将这个列表转换为一个字符串。在此之后，在这个字符串最后添加一个换行符<code>\n</code>。<code>filewriter</code>对象将这个字符串写入输出文件，作为输出文件的第一行。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for row in filereader:</span><br><span class="line">    row = row.strip()</span><br><span class="line">    row_list = row.split(&apos;,&apos;)</span><br><span class="line">    print(row_list)</span><br><span class="line">    filewriter.write(&apos;,&apos;.join(map(str, row_list)) + &apos;\n&apos;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里创建了一个for循环，在输入文件剩余的各行中迭代。<code>strip()</code>除去每行字符串两端的空格、换行符和制表符。<code>split(&#39;,&#39;)</code>用逗号将字符串拆分成一个列表并赋给变量<code>row_list</code>，列表中的每个值都是这行中某一列的值。最后，将这些值打印到屏幕上并写入输出文件。<br>&emsp;&emsp;我们在命令行窗口运行这个脚本，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200119082504658.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">&emsp;&emsp;输入文件的所有行都被打印到了屏幕上，也被写入了输出文件。<br><img src="https://img-blog.csdnimg.cn/20200119082658257.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-使用pandas模块"><a href="#2-使用pandas模块" class="headerlink" title="2.使用pandas模块"></a>2.使用pandas模块</h4><p>&emsp;&emsp;使用pandas模块处理CSV文件的代码如下所示：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import pandas as pd</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line">data_frame = pd.read_csv(input_file)</span><br><span class="line">print(data_frame)</span><br><span class="line">data_frame.to_csv(output_file, index=False)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这里我们创建了一个变量<code>data_frame</code>，这种数据方式叫做<strong>数据框</strong>。数据框中保留了“表格”这种组织方式，不需要使用列表套列表的方式来分析数据。数据框包含在pandas中，如果我们没有在脚本中导入pandas模块，就不能使用数据框。<br>&emsp;&emsp;在学习阶段，将这个变量命名为<code>data_frame</code>是可以的，但是以后，我们应该使用更有描述性的变量名。<br>&emsp;&emsp;我们在命令行窗口运行这个脚本，如下图所示。<br><img src="https://img-blog.csdnimg.cn/20200119083552160.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20200119083641933.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTU0MDEw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="disabled" href="/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/2/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    I'd walk a million miles just to see your smile. 
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2020/02/07/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(4)/">Python数据分析基础之Excel文件(4)</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2020/02/07/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(3)/">Python数据分析基础之Excel文件(3)</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2020/02/03/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(2)/">Python数据分析基础之Excel文件(2)</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2020/01/28/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80%E4%B9%8BExcel%E6%96%87%E4%BB%B6(1)/">Python数据分析基础之Excel文件(1)</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/CCH21" target="_blank" rel="noopener">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:1398635912@qq.com" target="_blank" rel="noopener">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/" target="_blank" rel="noopener">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>